{"version":3,"sources":["app/ajax.js","app/app.js","app/bindings.js","app/bindings/header.js","app/bindings/page_component.js","app/bindings/time_ago.js","app/bindings/title.js","app/components/article.js","app/components/article_list.js","app/components/article_preview.js","app/components/home.js","app/controllers/articles.js","app/controllers/home.js","app/initialize.js","app/lib/history.js","app/lib/time_ago.js","app/lib/utils.js","app/router.js"],"names":["CONTENT_TYPES","CALLBACKS","TYPES","out","key","hasOwnProperty","push","isLocal","url","a","document","createElement","href","hostname","window","location","isFormData","data","constructor","toString","match","xhrFactory","xhr","XMLHttpRequest","XDomainRequest","ActiveXObject","noop","objectKeys","Object","keys","defaults","method","type","token","timeout","headers","forEach","callback","merge","b","mergeData","append","serializeForm","form","fields","querySelectorAll","call","field","name","value","Request","args","self","_getToken","_prepData","prototype","init","_validate","_defaultHeaders","open","_setRequestHeaders","_bindEvents","onStart","setTimeout","send","_parseData","ontimeout","onTimeout","_xDomainRequest","onload","onSuccess","onFinish","onerror","onError","pnprogress","onreadystatechange","readyState","status","setRequestHeader","indexOf","Error","_contentType","el","getElementsByName","content","JSON","stringify","_dataToURLEncoded","map","encodeURIComponent","join","request","configure","config","App","pageComponent","observable","pageParams","pageClass","pageTitle","pageLoading","getPage","component","params","async","onComponentPageLoaded","applyBindings","getElementById","TIMELINE_LENGTH","HEADER_RANGE","from","to","LOGO_RANGE","getProgress","scrolled","Math","min","gap","props","progress","scrollY","documentElement","scrollTop","bindingHandlers","header","valueAccessor","allBindings","viewModel","bindingContext","container","logo","update","elHeight","style","height","paddingTop","onScroll","e","addEventListener","SHOW_CLASS","componentName","actualComponentName","extend","notify","classList","remove","subscribe","newComponent","offsetHeight","scroll","add","timeAgo","time","unwrap","destroy","baseTitle","title","components","register","createdAt","updatedAt","tldr","themeClass","next","prev","article","parse","responseText","created_at","updated_at","pageClassAccessor","theme_class","pageTitleAccessor","alert","template","articles","observableArray","onLoad","preview","path","articlesURL","addRoute","year","slug","f","n","Date","toJSON","isFinite","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","String","Number","Boolean","cx","escapable","indent","meta","rep","quote","string","lastIndex","test","replace","c","charCodeAt","slice","str","holder","i","k","v","length","mind","partial","apply","replacer","space","text","reviver","j","walk","undefined","eval","SyntaxError","History","Adapter","handlers","_uid","uid","element","bind","eventName","event","trigger","extractEventData","result","onDomLoad","clearTimeout","setInterval","initHtml4","initialized","enabled","savedHashes","isLastHash","newHash","oldHash","getHashByIndex","isLast","isHashEqual","saveHash","index","hash","discardedHashes","discardedStates","discardState","discardedState","forwardState","backState","discardedStateHash","getHashByState","discardObject","discardHash","discardedHash","State","StateHash","discarded","recycleState","emulated","hashChange","hashChangeInit","checkerFunction","lastDocumentHash","iframeId","iframe","lastIframeHash","checkerRunning","startedWithHash","getHash","isInternetExplorer","setAttribute","display","body","appendChild","contentWindow","close","documentHash","iframeHash","escapeHash","back","setHash","intervalList","options","hashChangeInterval","pushState","onHashChange","currentUrl","newURL","getLocationHref","currentHash","getHashByUrl","currentState","currentStateHash","currentStateHashExits","busy","doubleCheckComplete","isTraditionalAnchor","extractState","getFullUrl","isLastSavedState","forward","encodeURI","queue","pushQueue","scope","arguments","newState","createStateObject","newStateHash","oldState","getState","oldStateHash","html4Hash","wasExpected","expectedStateId","id","storeState","setTitle","saveState","getShortUrl","replaceState","previousState","getStateByIndex","console","navigator","sessionStorage","clearInterval","history","setItem","removeItem","encode","decode","initCore","safariPollInterval","doubleCheckInterval","disableSuid","storeInterval","busyDelay","debug","initialTitle","html4Mode","delayInit","clearAllIntervals","il","log","consoleExists","textarea","message","arg","Array","shift","Exception","scrollHeight","clientHeight","getInternetExplorerMajorVersion","cached","div","all","getElementsByTagName","innerHTML","userAgent","bugs","vendor","safariPoll","ieDoubleCheck","hashEscape","isEmptyObject","obj","cloneObject","newObj","getRootUrl","rootUrl","protocol","host","port","getBaseHref","baseElements","baseElement","baseHref","getBaseUrl","baseUrl","getBasePageUrl","getPageUrl","stateUrl","pageUrl","part","basePageUrl","allowBaseHref","fullUrl","firstChar","substring","shortUrl","doc","URL","decodeURIComponent","store","idToState","stateToId","urlToId","storedStates","savedStates","normalizeStore","friendly","create","getLastSavedState","cleanUrl","getIdByState","extractId","getStateString","getTime","random","normalizeState","dataNotEmpty","normalized","hashedUrl","hasUrlDuplicate","getStateById","passedState","cleanedState","getStateId","url_or_hash","parts","tmp","split","exec","isTraditional","getIdByUrl","getLastStoredState","hasDuplicate","newId","oldId","getCurrentIndex","unescapeHash","normalizeHash","firstState","queues","flag","fireNext","item","fireQueueItem","clearQueue","stateChanged","doubleChecker","doubleCheckClear","doubleCheck","tryAgain","safariStatePoll","urlState","go","emptyFunction","onPopState","extra","stateId","getItem","err","onUnload","currentStore","currentStoreString","code","DOMException","QUOTA_EXCEEDED_ERR","appCodeName","UNITS","fn","ms","abs","TimeAgo","date","_parseTime","_getDifference","_getTime","getAttribute","t","_calculateMeasure","lastMeasure","lastUnit","unit","measure","difference","_setTimeout","that","_timeout","_measureString","floor","_longOutput","prefix","measureFloor","unitString","unshift","_shortOutput","_isSeconds","_outputString","els","times","new","dgid","$","selector","querySelector","$$","throttle","threshhold","last","deferTimer","context","now","pathname","search","bypassed","route","urlPath","target","tagName","preventDefault","parentNode"],"mappings":"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","file":"../server/public/app.js","sourcesContent":["\n    var CONTENT_TYPES = {\n      'URLENCODED': 'application/x-www-form-urlencoded',\n      'JSON': 'application/json'\n    };\n\n    var CALLBACKS = [\n      'onStart',\n      'onSuccess',\n      'onError',\n      'onFinish',\n      'onTimeout'\n    ];\n\n    // ['URLENCODED', 'JSON'...]\n    var TYPES = (function(CONTENT_TYPES){\n\n      var out = [];\n\n      for(var key in CONTENT_TYPES){\n        if(CONTENT_TYPES.hasOwnProperty(key)){\n          out.push(key);\n        }\n      }\n\n      return out;\n\n    })(CONTENT_TYPES);\n\n    /** @returns {bool} */\n    var isLocal = function(url) {\n      var a = document.createElement('a');\n\n      a.href = url;\n\n      return a.hostname === window.location.hostname;\n    };\n\n    /** @returns {boolean} */\n    var isFormData = function(data) {\n      return !!data.constructor.toString().match('FormData');\n    };\n\n    /** @returns xhr instance */\n    var xhrFactory = function(url) {\n      var xhr = new XMLHttpRequest();\n\n      // ie >= 10 and browsers\n      if ('withCredentials' in xhr) {\n        return xhr;\n      }\n\n      // ie9 xDomain\n      if(!isLocal(url)) {\n        return new XDomainRequest();\n      }\n\n      // ie9 local\n      return new ActiveXObject('Msxml2.XMLHTTP');\n    };\n\n    var noop = function() {};\n\n    // Cause minification\n    var objectKeys = Object.keys;\n\n    /** Default args for ajax request. */\n    var defaults = {\n      url: null,\n      method: 'GET',\n      type: 'URLENCODED',\n      data: {},\n      token: null,\n      timeout: 0,\n      headers: {}\n    };\n\n    CALLBACKS.forEach(function(callback) {\n      defaults[callback] = noop;\n    });\n\n    /**\n     * @param {object} a\n     * @param {object} b\n     * @returns {object} - a merged into b\n     */\n    var merge = function(a, b) {\n      objectKeys(a).forEach(function(key) {\n        b[key] = a[key];\n      });\n\n      return b;\n    };\n\n    var mergeData = function(a, b) {\n      if(isFormData(a)) {\n        objectKeys(b).forEach(function(key) {\n          a.append(key, b[key]);\n        });\n\n        return a;\n      } else {\n        return merge(b, a);\n      }\n    };\n\n    /**\n     * Take form and turn into js object\n     *\n     * @param form - form object\n     * @returns form data as js object\n     */\n    var serializeForm = function(form) {\n      var fields = form.querySelectorAll('input, textarea, select');\n\n      var out = {};\n\n      [].forEach.call(fields, function(field) {\n        var key = field.name;\n        var value = field.value;\n\n        if(key) {\n          out[key] = value;\n        }\n      });\n\n      return out;\n    };\n\n\n    /**\n     * Represents an ajax request\n     *\n     * @class Request\n     * @private\n     * @param {object} args - See Ajax.request\n     */\n    var Request = function(args) {\n      var self = this;\n\n      self.url = args.url || defaults.url;\n      self.method = args.method || defaults.method;\n      self.type = args.type || defaults.type;\n      self.token = args.token || defaults.token || self._getToken();\n      self.timeout = args.timeout || defaults.timeout;\n\n      self.headers = merge(args.headers || {}, defaults.headers);\n\n      self.data = self._prepData(args.data);\n\n      CALLBACKS.forEach(function(callback) {\n        self[callback] = args[callback] || defaults[callback];\n      });\n    };\n\n    Request.prototype = {\n      init: function() {\n        var self = this;\n\n        self._validate();\n        self._defaultHeaders();\n\n        self.xhr = xhrFactory(self.url);\n\n        self.xhr.open(self.method, self.url, true);\n        self.xhr.timeout = self.timeout;\n\n        self._setRequestHeaders();\n        self._bindEvents();\n\n        var xhr = self.xhr;\n\n        self.onStart(xhr);\n\n        // fix for ie9 xdomain\n        window.setTimeout(function() { self.xhr.send(self._parseData()); }, 0 );\n\n        return this;\n      },\n\n      /**\n       * @param data - request data / params\n       * @returns data params merged with defaults\n       */\n      _prepData: function(data) {\n        data = data || {};\n\n        if(!!data.constructor.toString().match('HTMLFormElement')) {\n          data = serializeForm(data);\n        } else {\n          data = data;\n        }\n\n        return mergeData(data, defaults.data);\n      },\n\n      _bindEvents: function() {\n        var self = this;\n        var xhr = self.xhr;\n\n        xhr.ontimeout = self.onTimeout;\n\n        // TODO: this is a bit nasty\n        if(this._xDomainRequest()) {\n\n          xhr.onload = function() {\n            self.onSuccess(xhr);\n            self.onFinish(xhr);\n          };\n\n          xhr.onerror = function() {\n            self.onError(xhr);\n            self.onFinish(xhr);\n          };\n\n          xhr.ontimeout = noop;\n          xhr.pnprogress = noop;\n        } else {\n\n          xhr.onreadystatechange = function(){\n            if(xhr.readyState === 4) {\n              if(xhr.status.toString().match(/2[0-9]{1,2}/)) {\n                self.onSuccess(xhr);\n              } else {\n                self.onError(xhr);\n              }\n\n              self.onFinish(xhr);\n            }\n          };\n        }\n      },\n\n      /** Are we using XDomainRequest object? */\n      _xDomainRequest: function() {\n        // TODO: make this nicer\n        return !('withCredentials' in new XMLHttpRequest()) && !isLocal();\n      },\n\n      _setRequestHeaders: function() {\n        var self = this;\n\n        // no headers for XDomainRequest (ie < 10)  :(\n        if(self._xDomainRequest()) {\n          return;\n        }\n\n        var headers = self.headers;\n\n        objectKeys(headers).forEach(function(key) {\n          self.xhr.setRequestHeader(key, headers[key]);\n        });\n      },\n\n      _validate: function() {\n        if(TYPES.indexOf(this.type) === -1) {\n          throw new Error('Ajax: Invalid type');\n        }\n\n        if(!this.url && !defaults.url) {\n          throw new Error('Ajax: URL required');\n        }\n      },\n\n      _defaultHeaders: function() {\n        var headers = this.headers;\n        var token = this.token;\n\n        if(!isFormData(this.data)) {\n          headers['Content-Type'] = this._contentType();\n        }\n\n        if(token) {\n          headers['X-CSRF-Token'] = token;\n        }\n      },\n\n      _contentType: function() {\n        return CONTENT_TYPES[this.type];\n      },\n\n      /** look for CSRF token in meta tag */\n      _getToken: function() {\n        var el = document.getElementsByName('csrf-token')[0];\n\n        if(typeof el !== 'undefined' && el !== null) {\n          return el.content;\n        }\n\n        return null;\n      },\n\n      /** @returns this.data formatted for request type, this.type */\n      _parseData: function() {\n        var self = this;\n        var data = self.data;\n\n        if(isFormData(data)) {\n          return data;\n        }\n\n        if(self.type === 'JSON') {\n          return JSON.stringify(data);\n        } else {\n          return self._dataToURLEncoded();\n        }\n      },\n\n      /** @returns this.data as url encoded params */\n      _dataToURLEncoded: function() {\n        var data = this.data;\n\n        var out = objectKeys(data).map(function(key) {\n          return key + '=' + encodeURIComponent(data[key]);\n        });\n\n        return out.join('&');\n      }\n    };\n\n    /** @class Ajax */\n    export default {\n      /**\n       * Makes an ajax request...\n       *\n       * @static\n       * @param {string} args.url - Request url\n       * @param {string} [args.method=GET] - Request method. Should be upper case string\n       * @param {string} [args.type=URLENCODED] - Request type. Must be `URLENCODED`, or `JSON`.\n       * @param {object} [args.data] - Request params as js object, form object, or FormData.\n       * @param {string} [args.token] - Manually set X-CSRF-Token token header.\n       * @param {integer} [args.timeout] - Request timeout. Default is no timeout.\n       * @param {object} [args.object] - Request headers as key value pairs.\n       * @param {function} [args.onStart] - Callback fired at start of request.\n       * @param {function} [args.onSuccess] - Callback fired on successful completion of request (2xx response).\n       * @param {function} [args.onError] - Callback fired if request response is not in 200 range.\n       * @param {function} [args.onTimeout] - Callback fired at if request times out.\n       * @param {function} [args.onFinish] - Callback fired after request successful or not.\n       */\n      request: function(args) {\n        return new Request(args).init();\n      },\n\n      /**\n       * Change defaults for #request\n       *\n       * @static\n       * @param {object} config - Defaults for future calls to #request. Keys are\n       * the same as those documented for #request.\n       * @returns {object} - new defaults for #request (config merged into defaults)\n       */\n      configure: function(config) {\n        return merge(config, defaults);\n      }\n    }\n","import ko from 'knockout'\nimport Router from 'router'\n\nimport 'controllers/home'\nimport 'controllers/articles'\n\nimport 'bindings'\n\nlet App = {\n\n  pageComponent: ko.observable('home'),\n  pageParams: ko.observable({}),\n  pageClass: ko.observable(),\n  pageTitle: ko.observable(),\n\n  pageLoading: ko.observable(false),\n\n  getPage: (component, params, async = true) => {\n    params = params || {}\n\n    if(async) {\n      // Call this after async content loaded\n      params.onComponentPageLoaded = () => {\n        App.pageLoading(false)\n      }\n\n      App.pageLoading(true)\n    }\n\n    App.pageComponent(component)\n    App.pageParams(params)\n  },\n\n  init: () => {\n    Router.init(App)\n    ko.applyBindings(App, document.getElementById(\"htmlTop\"))\n  }\n\n}\n\nexport default App\n","import 'bindings/time_ago'\nimport 'bindings/title'\nimport 'bindings/page_component'\nimport 'bindings/header'\n","import ko from 'knockout'\nimport { throttle, dgid } from '../lib/utils'\n\nconst TIMELINE_LENGTH = 300 // px\nconst HEADER_RANGE = { from: 500, to: 80 }\nconst LOGO_RANGE = { from: 190, to: 60 }\n\n// @returns % of way through 'timeline'\nconst getProgress = (scrolled) => {\n  return Math.min(((scrolled / TIMELINE_LENGTH) * 100), 100)\n}\n\nconst gap = (props) => {\n  return props.from - props.to\n}\n\nconst value = (progress, props) => {\n  return props.from - (progress / 100) * gap(props)\n}\n\nconst scrollY = () => {\n  return window.scrollY || document.documentElement.scrollTop\n}\n\nko.bindingHandlers.header = {\n\n  init: function(el, valueAccessor, allBindings, viewModel, bindingContext) {\n\n    let container = dgid('container')\n    let logo = dgid('logo')\n\n    let update = (progress) => {\n      let elHeight = `${value(progress, HEADER_RANGE)}px`\n\n      el.style.height = elHeight\n      container.style.paddingTop = elHeight\n      logo.style.height = `${value(progress, LOGO_RANGE)}px`\n    }\n\n    update(getProgress(scrollY()))\n\n    let onScroll = throttle(function(e) {\n      update(getProgress(scrollY()))\n    }, (1000/60), this)\n\n    window.addEventListener('scroll', onScroll)\n\n  }\n\n}\n","import ko from 'knockout'\n\nconst SHOW_CLASS = 'animate-in'\n\nko.bindingHandlers.pageComponent = {\n\n  init: function(el, valueAccessor, allBindings, viewModel, bindingContext) {\n    let value = valueAccessor()\n    let componentName = value.name\n    let actualComponentName = ko.observable(componentName())\n\n    // Get transition changing between pages with same template\n    componentName.extend({ notify: 'always' })\n\n    el.addEventListener('animationend', () => {\n      el.classList.remove(SHOW_CLASS)\n      // Take on actual height with new content\n      el.style.height = ''\n    })\n\n    componentName.subscribe((newComponent) => {\n\n      // Keep current height so that footer dosent jump up the  page\n      el.style.height = `${el.offsetHeight}px`\n\n      // Vanish\n      window.scroll(0, 0)\n\n      // Change page content\n      actualComponentName(newComponent)\n\n      // TODO: Handle loading state... callback to page component to signal ready.\n\n      // Re-appear\n      el.classList.add(SHOW_CLASS)\n\n    })\n\n    // Use component binding to handle actual component changes :)\n    ko.bindingHandlers.component.init(el, () => {\n      return { name: actualComponentName, params: value.params }\n    }, allBindings, viewModel, bindingContext)\n  }\n}\n","import ko from 'knockout'\nimport TimeAgo from '../lib/time_ago'\n\nlet timeAgo\n\nko.bindingHandlers.timeAgo = {\n\n  update: function(el, valueAccessor, allBindings, viewModel, bindingContext) {\n    let time = ko.unwrap(valueAccessor())\n\n    if(timeAgo) {\n      timeAgo.destroy()\n    }\n\n    timeAgo = new TimeAgo(el, time)\n  }\n}\n","import ko from 'knockout'\n\nlet baseTitle\n\nko.bindingHandlers.title = {\n\n  init: function(el, valueAccessor, allBindings, viewModel, bindingContext) {\n    baseTitle = document.title\n  },\n\n  update: function(el, valueAccessor, allBindings, viewModel, bindingContext) {\n    let pageTitle = ko.unwrap(valueAccessor())\n\n    document.title = pageTitle ? `${pageTitle} | ${baseTitle}` : baseTitle\n  }\n}\n","import ko from 'knockout'\nimport Ajax from 'ajax'\n\nko.components.register('article', {\n  viewModel: function(params) {\n\n    this.title = ko.observable()\n    this.content = ko.observable()\n    this.createdAt = ko.observable()\n    this.updatedAt = ko.observable()\n    this.tldr = ko.observable()\n    this.themeClass = ko.observable()\n    this.next = ko.observable()\n    this.prev = ko.observable()\n\n    // this.commentsUrl = params.commentsUrl\n\n    Ajax.request({\n      url: params.url,\n\n      onSuccess: (xhr) => {\n\n        let article = JSON.parse(xhr.responseText)\n\n        this.title(article.title)\n        this.content(article.content)\n        this.createdAt(article.created_at)\n        this.updatedAt(article.updated_at)\n        this.tldr(article.tldr)\n        this.next(article.next)\n        this.prev(article.prev)\n\n        params.pageClassAccessor(article.theme_class)\n        params.pageTitleAccessor(article.title)\n        params.onComponentPageLoaded.call()\n\n      },\n\n      onError: () => {\n        alert('Could not get article. Please try again later.')\n      }\n    })\n  },\n\n  template: `\n    <article>\n\n      <header>\n        <h1 data-bind=\"text: title\"></h1>\n      </header>\n\n      <section class=\"article-content\">\n        <div data-bind=\"html: content\"></div>\n      </section>\n\n      <footer>\n\n        <div class=\"tldr\" data-bind=\"with: tldr\">\n          <h3>tldr:</h3>\n\n          <p data-bind=\"html: $data\"></p>\n        </div>\n\n        <p data-bind=\"visible: createdAt\">Created <time data-bind=\"timeAgo: createdAt\"></time></p>\n        <p data-bind=\"visible: updatedAt\">Updated <time data-bind=\"timeAgo: updatedAt\"></time></p>\n\n        <ul class=\"next-prev\">\n          <li data-bind=\"visible: next, with: next\">\n            Next: <a data-bind=\"text: title, attr: { href: '/#' + path }\"></a>\n          </li>\n\n          <li data-bind=\"visible: prev, with: prev\">\n            Previous: <a data-bind=\"text: title, attr: { href: '/#' + path }\"></a>\n          </li>\n        </ul>\n\n      </footer>\n\n    </article>\n  `\n})\n","import ko from 'knockout'\nimport Ajax from 'ajax'\n\nimport 'components/article_preview'\n\nko.components.register('article-list', {\n  viewModel: function(params) {\n    this.articles = ko.observableArray();\n\n    Ajax.request({\n      url: params.url,\n      onSuccess: (xhr) => {\n        this.articles(JSON.parse(xhr.responseText))\n        params.onLoad.call()\n      }\n    })\n  },\n\n  template: `\n    <ul data-bind='foreach: articles' class=\"article-list\">\n      <li>\n        <article-preview params=\"{ path: path, title: title, preview: preview, createdAt: created_at, themeClass: theme_class }\">\n        </article-preview>\n      </li>\n    </ul>\n  `\n})\n","import ko from 'knockout'\n\nko.components.register('article-preview', {\n  viewModel: function(params) {\n\n    this.title = params.title\n    this.createdAt = params.createdAt\n    this.preview = params.preview\n    this.path = params.path\n    this.themeClass = params.themeClass\n\n  },\n\n  template: `\n    <article class=\"article-preview\" data-bind=\"css: themeClass\">\n\n      <header>\n        <a data-bind=\"attr: { href: path }\">\n          <h2 data-bind=\"text: title\"></h2>\n        </a>\n      </header>\n\n      <div data-bind=\"text: preview\"></div>\n\n      <footer>\n        <p>\n          Created <time data-bind=\"timeAgo: createdAt\"></time>\n        </p>\n      </footer>\n\n    </article>\n  `\n})\n","import ko from 'knockout'\n\nimport 'components/article_list'\n\nko.components.register('home', {\n  viewModel: function(params) {\n    this.articlesURL = params.url\n    this.onLoad = params.onComponentPageLoaded\n  },\n\n  template: `\n    <article-list params=\"{ url: articlesURL, onLoad: onLoad }\"></article-list>\n  `\n})\n","import Crossroads from 'crossroads'\nimport App from 'app'\n\nimport '../components/article'\n\nCrossroads.addRoute('{year}/{slug}', (year, slug) => {\n\n  let url = `/${year}/${slug}.json`\n\n  App.getPage('article', {\n    url: url,\n    pageClassAccessor: App.pageClass,\n    pageTitleAccessor: App.pageTitle\n  })\n\n})\n","import Crossroads from 'crossroads'\nimport App from 'app'\n\nimport '../components/home'\n\nCrossroads.addRoute('', () => {\n  App.pageClass('')\n  App.pageTitle('')\n  App.getPage('home', { url: `/index.json` })\n})\n","import App from 'app'\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  App.init()\n});\n","/*\n    json2.js\n    2012-10-08\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    See http://www.JSON.org/js.html\n\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n\n\n    This file creates a global JSON object containing two methods: stringify\n    and parse.\n\n        JSON.stringify(value, replacer, space)\n            value       any JavaScript value, usually an object or array.\n\n            replacer    an optional parameter that determines how object\n                        values are stringified for objects. It can be a\n                        function or an array of strings.\n\n            space       an optional parameter that specifies the indentation\n                        of nested structures. If it is omitted, the text will\n                        be packed without extra whitespace. If it is a number,\n                        it will specify the number of spaces to indent at each\n                        level. If it is a string (such as '\\t' or '&nbsp;'),\n                        it contains the characters used to indent at each level.\n\n            This method produces a JSON text from a JavaScript value.\n\n            When an object value is found, if the object contains a toJSON\n            method, its toJSON method will be called and the result will be\n            stringified. A toJSON method does not serialize: it returns the\n            value represented by the name/value pair that should be serialized,\n            or undefined if nothing should be serialized. The toJSON method\n            will be passed the key associated with the value, and this will be\n            bound to the value\n\n            For example, this would serialize Dates as ISO strings.\n\n                Date.prototype.toJSON = function (key) {\n                    function f(n) {\n                        // Format integers to have at least two digits.\n                        return n < 10 ? '0' + n : n;\n                    }\n\n                    return this.getUTCFullYear()   + '-' +\n                         f(this.getUTCMonth() + 1) + '-' +\n                         f(this.getUTCDate())      + 'T' +\n                         f(this.getUTCHours())     + ':' +\n                         f(this.getUTCMinutes())   + ':' +\n                         f(this.getUTCSeconds())   + 'Z';\n                };\n\n            You can provide an optional replacer method. It will be passed the\n            key and value of each member, with this bound to the containing\n            object. The value that is returned from your method will be\n            serialized. If your method returns undefined, then the member will\n            be excluded from the serialization.\n\n            If the replacer parameter is an array of strings, then it will be\n            used to select the members to be serialized. It filters the results\n            such that only members with keys listed in the replacer array are\n            stringified.\n\n            Values that do not have JSON representations, such as undefined or\n            functions, will not be serialized. Such values in objects will be\n            dropped; in arrays they will be replaced with null. You can use\n            a replacer function to replace those with JSON values.\n            JSON.stringify(undefined) returns undefined.\n\n            The optional space parameter produces a stringification of the\n            value that is filled with line breaks and indentation to make it\n            easier to read.\n\n            If the space parameter is a non-empty string, then that string will\n            be used for indentation. If the space parameter is a number, then\n            the indentation will be that many spaces.\n\n            Example:\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}]);\n            // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n            // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n            text = JSON.stringify([new Date()], function (key, value) {\n                return this[key] instanceof Date ?\n                    'Date(' + this[key] + ')' : value;\n            });\n            // text is '[\"Date(---current time---)\"]'\n\n\n        JSON.parse(text, reviver)\n            This method parses a JSON text to produce an object or array.\n            It can throw a SyntaxError exception.\n\n            The optional reviver parameter is a function that can filter and\n            transform the results. It receives each of the keys and values,\n            and its return value is used instead of the original value.\n            If it returns what it received, then the structure is not modified.\n            If it returns undefined then the member is deleted.\n\n            Example:\n\n            // Parse the text. Values that look like ISO date strings will\n            // be converted to Date objects.\n\n            myData = JSON.parse(text, function (key, value) {\n                var a;\n                if (typeof value === 'string') {\n                    a =\n/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n                    if (a) {\n                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n                            +a[5], +a[6]));\n                    }\n                }\n                return value;\n            });\n\n            myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n                var d;\n                if (typeof value === 'string' &&\n                        value.slice(0, 5) === 'Date(' &&\n                        value.slice(-1) === ')') {\n                    d = new Date(value.slice(5, -1));\n                    if (d) {\n                        return d;\n                    }\n                }\n                return value;\n            });\n\n\n    This is a reference implementation. You are free to copy, modify, or\n    redistribute.\n*/\n\n/*jslint evil: true, regexp: true */\n\n/*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n    test, toJSON, toString, valueOf\n*/\n\n\n// Create a JSON object only if one does not already exist. We create the\n// methods in a closure to avoid creating global variables.\n\nif (typeof JSON !== 'object') {\n    JSON = {};\n}\n\n(function () {\n    'use strict';\n\n    function f(n) {\n        // Format integers to have at least two digits.\n        return n < 10 ? '0' + n : n;\n    }\n\n    if (typeof Date.prototype.toJSON !== 'function') {\n\n        Date.prototype.toJSON = function (key) {\n\n            return isFinite(this.valueOf())\n                ? this.getUTCFullYear()     + '-' +\n                    f(this.getUTCMonth() + 1) + '-' +\n                    f(this.getUTCDate())      + 'T' +\n                    f(this.getUTCHours())     + ':' +\n                    f(this.getUTCMinutes())   + ':' +\n                    f(this.getUTCSeconds())   + 'Z'\n                : null;\n        };\n\n        String.prototype.toJSON      =\n            Number.prototype.toJSON  =\n            Boolean.prototype.toJSON = function (key) {\n                return this.valueOf();\n            };\n    }\n\n    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        gap,\n        indent,\n        meta = {    // table of character substitutions\n            '\\b': '\\\\b',\n            '\\t': '\\\\t',\n            '\\n': '\\\\n',\n            '\\f': '\\\\f',\n            '\\r': '\\\\r',\n            '\"' : '\\\\\"',\n            '\\\\': '\\\\\\\\'\n        },\n        rep;\n\n\n    function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n        escapable.lastIndex = 0;\n        return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n            var c = meta[a];\n            return typeof c === 'string'\n                ? c\n                : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n        }) + '\"' : '\"' + string + '\"';\n    }\n\n\n    function str(key, holder) {\n\n// Produce a string from holder[key].\n\n        var i,          // The loop counter.\n            k,          // The member key.\n            v,          // The member value.\n            length,\n            mind = gap,\n            partial,\n            value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n        if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n            value = value.toJSON(key);\n        }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n        if (typeof rep === 'function') {\n            value = rep.call(holder, key, value);\n        }\n\n// What happens next depends on the value's type.\n\n        switch (typeof value) {\n        case 'string':\n            return quote(value);\n\n        case 'number':\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n            return isFinite(value) ? String(value) : 'null';\n\n        case 'boolean':\n        case 'null':\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce 'null'. The case is included here in\n// the remote chance that this gets fixed someday.\n\n            return String(value);\n\n// If the type is 'object', we might be dealing with an object or an array or\n// null.\n\n        case 'object':\n\n// Due to a specification blunder in ECMAScript, typeof null is 'object',\n// so watch out for that case.\n\n            if (!value) {\n                return 'null';\n            }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n            gap += indent;\n            partial = [];\n\n// Is the value an array?\n\n            if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                length = value.length;\n                for (i = 0; i < length; i += 1) {\n                    partial[i] = str(i, value) || 'null';\n                }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                v = partial.length === 0\n                    ? '[]'\n                    : gap\n                    ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                    : '[' + partial.join(',') + ']';\n                gap = mind;\n                return v;\n            }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n            if (rep && typeof rep === 'object') {\n                length = rep.length;\n                for (i = 0; i < length; i += 1) {\n                    if (typeof rep[i] === 'string') {\n                        k = rep[i];\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                for (k in value) {\n                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n            v = partial.length === 0\n                ? '{}'\n                : gap\n                ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                : '{' + partial.join(',') + '}';\n            gap = mind;\n            return v;\n        }\n    }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n    if (typeof JSON.stringify !== 'function') {\n        JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n            var i;\n            gap = '';\n            indent = '';\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n            if (typeof space === 'number') {\n                for (i = 0; i < space; i += 1) {\n                    indent += ' ';\n                }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n            } else if (typeof space === 'string') {\n                indent = space;\n            }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n            rep = replacer;\n            if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                    typeof replacer.length !== 'number')) {\n                throw new Error('JSON.stringify');\n            }\n\n// Make a fake root object containing our value under the key of ''.\n// Return the result of stringifying the value.\n\n            return str('', {'': value});\n        };\n    }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n    if (typeof JSON.parse !== 'function') {\n        JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k, v, value = holder[key];\n                if (value && typeof value === 'object') {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            cx.lastIndex = 0;\n            if (cx.test(text)) {\n                text = text.replace(cx, function (a) {\n                    return '\\\\u' +\n                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n            if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                        .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                        .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return typeof reviver === 'function'\n                    ? walk({'': j}, '')\n                    : j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError('JSON.parse');\n        };\n    }\n}());/**\n * History.js Native Adapter\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n// Closure\n(function(window,undefined){\n  \"use strict\";\n\n  // Localise Globals\n  var History = window.History = window.History||{};\n\n  // Check Existence\n  if ( typeof History.Adapter !== 'undefined' ) {\n    throw new Error('History.js Adapter has already been loaded...');\n  }\n\n  // Add the Adapter\n  History.Adapter = {\n    /**\n     * History.Adapter.handlers[uid][eventName] = Array\n     */\n    handlers: {},\n\n    /**\n     * History.Adapter._uid\n     * The current element unique identifier\n     */\n    _uid: 1,\n\n    /**\n     * History.Adapter.uid(element)\n     * @param {Element} element\n     * @return {String} uid\n     */\n    uid: function(element){\n      return element._uid || (element._uid = History.Adapter._uid++);\n    },\n\n    /**\n     * History.Adapter.bind(el,event,callback)\n     * @param {Element} element\n     * @param {String} eventName - custom and standard events\n     * @param {Function} callback\n     * @return\n     */\n    bind: function(element,eventName,callback){\n      // Prepare\n      var uid = History.Adapter.uid(element);\n\n      // Apply Listener\n      History.Adapter.handlers[uid] = History.Adapter.handlers[uid] || {};\n      History.Adapter.handlers[uid][eventName] = History.Adapter.handlers[uid][eventName] || [];\n      History.Adapter.handlers[uid][eventName].push(callback);\n\n      // Bind Global Listener\n      element['on'+eventName] = (function(element,eventName){\n        return function(event){\n          History.Adapter.trigger(element,eventName,event);\n        };\n      })(element,eventName);\n    },\n\n    /**\n     * History.Adapter.trigger(el,event)\n     * @param {Element} element\n     * @param {String} eventName - custom and standard events\n     * @param {Object} event - a object of event data\n     * @return\n     */\n    trigger: function(element,eventName,event){\n      // Prepare\n      event = event || {};\n      var uid = History.Adapter.uid(element),\n        i,n;\n\n      // Apply Listener\n      History.Adapter.handlers[uid] = History.Adapter.handlers[uid] || {};\n      History.Adapter.handlers[uid][eventName] = History.Adapter.handlers[uid][eventName] || [];\n\n      // Fire Listeners\n      for ( i=0,n=History.Adapter.handlers[uid][eventName].length; i<n; ++i ) {\n        History.Adapter.handlers[uid][eventName][i].apply(this,[event]);\n      }\n    },\n\n    /**\n     * History.Adapter.extractEventData(key,event,extra)\n     * @param {String} key - key for the event data to extract\n     * @param {String} event - custom and standard events\n     * @return {mixed}\n     */\n    extractEventData: function(key,event){\n      var result = (event && event[key]) || undefined;\n      return result;\n    },\n\n    /**\n     * History.Adapter.onDomLoad(callback)\n     * @param {Function} callback\n     * @return\n     */\n    onDomLoad: function(callback) {\n      var timeout = window.setTimeout(function(){\n        callback();\n      },2000);\n      window.onload = function(){\n        clearTimeout(timeout);\n        callback();\n      };\n    }\n  };\n\n  // Try to Initialise History\n  if ( typeof History.init !== 'undefined' ) {\n    History.init();\n  }\n\n})(window);\n/**\n * History.js HTML4 Support\n * Depends on the HTML5 Support\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n  \"use strict\";\n\n  // ========================================================================\n  // Initialise\n\n  // Localise Globals\n  var\n    document = window.document, // Make sure we are using the correct document\n    setTimeout = window.setTimeout||setTimeout,\n    clearTimeout = window.clearTimeout||clearTimeout,\n    setInterval = window.setInterval||setInterval,\n    History = window.History = window.History||{}; // Public History Object\n\n  // Check Existence\n  if ( typeof History.initHtml4 !== 'undefined' ) {\n    throw new Error('History.js HTML4 Support has already been loaded...');\n  }\n\n\n  // ========================================================================\n  // Initialise HTML4 Support\n\n  // Initialise HTML4 Support\n  History.initHtml4 = function(){\n    // Initialise\n    if ( typeof History.initHtml4.initialized !== 'undefined' ) {\n      // Already Loaded\n      return false;\n    }\n    else {\n      History.initHtml4.initialized = true;\n    }\n\n\n    // ====================================================================\n    // Properties\n\n    /**\n     * History.enabled\n     * Is History enabled?\n     */\n    History.enabled = true;\n\n\n    // ====================================================================\n    // Hash Storage\n\n    /**\n     * History.savedHashes\n     * Store the hashes in an array\n     */\n    History.savedHashes = [];\n\n    /**\n     * History.isLastHash(newHash)\n     * Checks if the hash is the last hash\n     * @param {string} newHash\n     * @return {boolean} true\n     */\n    History.isLastHash = function(newHash){\n      // Prepare\n      var oldHash = History.getHashByIndex(),\n        isLast;\n\n      // Check\n      isLast = newHash === oldHash;\n\n      // Return isLast\n      return isLast;\n    };\n\n    /**\n     * History.isHashEqual(newHash, oldHash)\n     * Checks to see if two hashes are functionally equal\n     * @param {string} newHash\n     * @param {string} oldHash\n     * @return {boolean} true\n     */\n    History.isHashEqual = function(newHash, oldHash){\n      newHash = encodeURIComponent(newHash).replace(/%25/g, \"%\");\n      oldHash = encodeURIComponent(oldHash).replace(/%25/g, \"%\");\n      return newHash === oldHash;\n    };\n\n    /**\n     * History.saveHash(newHash)\n     * Push a Hash\n     * @param {string} newHash\n     * @return {boolean} true\n     */\n    History.saveHash = function(newHash){\n      // Check Hash\n      if ( History.isLastHash(newHash) ) {\n        return false;\n      }\n\n      // Push the Hash\n      History.savedHashes.push(newHash);\n\n      // Return true\n      return true;\n    };\n\n    /**\n     * History.getHashByIndex()\n     * Gets a hash by the index\n     * @param {integer} index\n     * @return {string}\n     */\n    History.getHashByIndex = function(index){\n      // Prepare\n      var hash = null;\n\n      // Handle\n      if ( typeof index === 'undefined' ) {\n        // Get the last inserted\n        hash = History.savedHashes[History.savedHashes.length-1];\n      }\n      else if ( index < 0 ) {\n        // Get from the end\n        hash = History.savedHashes[History.savedHashes.length+index];\n      }\n      else {\n        // Get from the beginning\n        hash = History.savedHashes[index];\n      }\n\n      // Return hash\n      return hash;\n    };\n\n\n    // ====================================================================\n    // Discarded States\n\n    /**\n     * History.discardedHashes\n     * A hashed array of discarded hashes\n     */\n    History.discardedHashes = {};\n\n    /**\n     * History.discardedStates\n     * A hashed array of discarded states\n     */\n    History.discardedStates = {};\n\n    /**\n     * History.discardState(State)\n     * Discards the state by ignoring it through History\n     * @param {object} State\n     * @return {true}\n     */\n    History.discardState = function(discardedState,forwardState,backState){\n      //History.debug('History.discardState', arguments);\n      // Prepare\n      var discardedStateHash = History.getHashByState(discardedState),\n        discardObject;\n\n      // Create Discard Object\n      discardObject = {\n        'discardedState': discardedState,\n        'backState': backState,\n        'forwardState': forwardState\n      };\n\n      // Add to DiscardedStates\n      History.discardedStates[discardedStateHash] = discardObject;\n\n      // Return true\n      return true;\n    };\n\n    /**\n     * History.discardHash(hash)\n     * Discards the hash by ignoring it through History\n     * @param {string} hash\n     * @return {true}\n     */\n    History.discardHash = function(discardedHash,forwardState,backState){\n      //History.debug('History.discardState', arguments);\n      // Create Discard Object\n      var discardObject = {\n        'discardedHash': discardedHash,\n        'backState': backState,\n        'forwardState': forwardState\n      };\n\n      // Add to discardedHash\n      History.discardedHashes[discardedHash] = discardObject;\n\n      // Return true\n      return true;\n    };\n\n    /**\n     * History.discardedState(State)\n     * Checks to see if the state is discarded\n     * @param {object} State\n     * @return {bool}\n     */\n    History.discardedState = function(State){\n      // Prepare\n      var StateHash = History.getHashByState(State),\n        discarded;\n\n      // Check\n      discarded = History.discardedStates[StateHash]||false;\n\n      // Return true\n      return discarded;\n    };\n\n    /**\n     * History.discardedHash(hash)\n     * Checks to see if the state is discarded\n     * @param {string} State\n     * @return {bool}\n     */\n    History.discardedHash = function(hash){\n      // Check\n      var discarded = History.discardedHashes[hash]||false;\n\n      // Return true\n      return discarded;\n    };\n\n    /**\n     * History.recycleState(State)\n     * Allows a discarded state to be used again\n     * @param {object} data\n     * @param {string} title\n     * @param {string} url\n     * @return {true}\n     */\n    History.recycleState = function(State){\n      //History.debug('History.recycleState', arguments);\n      // Prepare\n      var StateHash = History.getHashByState(State);\n\n      // Remove from DiscardedStates\n      if ( History.discardedState(State) ) {\n        delete History.discardedStates[StateHash];\n      }\n\n      // Return true\n      return true;\n    };\n\n\n    // ====================================================================\n    // HTML4 HashChange Support\n\n    if ( History.emulated.hashChange ) {\n      /*\n       * We must emulate the HTML4 HashChange Support by manually checking for hash changes\n       */\n\n      /**\n       * History.hashChangeInit()\n       * Init the HashChange Emulation\n       */\n      History.hashChangeInit = function(){\n        // Define our Checker Function\n        History.checkerFunction = null;\n\n        // Define some variables that will help in our checker function\n        var lastDocumentHash = '',\n          iframeId, iframe,\n          lastIframeHash, checkerRunning,\n          startedWithHash = Boolean(History.getHash());\n\n        // Handle depending on the browser\n        if ( History.isInternetExplorer() ) {\n          // IE6 and IE7\n          // We need to use an iframe to emulate the back and forward buttons\n\n          // Create iFrame\n          iframeId = 'historyjs-iframe';\n          iframe = document.createElement('iframe');\n\n          // Adjust iFarme\n          // IE 6 requires iframe to have a src on HTTPS pages, otherwise it will throw a\n          // \"This page contains both secure and nonsecure items\" warning.\n          iframe.setAttribute('id', iframeId);\n          iframe.setAttribute('src', '#');\n          iframe.style.display = 'none';\n\n          // Append iFrame\n          document.body.appendChild(iframe);\n\n          // Create initial history entry\n          iframe.contentWindow.document.open();\n          iframe.contentWindow.document.close();\n\n          // Define some variables that will help in our checker function\n          lastIframeHash = '';\n          checkerRunning = false;\n\n          // Define the checker function\n          History.checkerFunction = function(){\n            // Check Running\n            if ( checkerRunning ) {\n              return false;\n            }\n\n            // Update Running\n            checkerRunning = true;\n\n            // Fetch\n            var\n              documentHash = History.getHash(),\n              iframeHash = History.getHash(iframe.contentWindow.document);\n\n            // The Document Hash has changed (application caused)\n            if ( documentHash !== lastDocumentHash ) {\n              // Equalise\n              lastDocumentHash = documentHash;\n\n              // Create a history entry in the iframe\n              if ( iframeHash !== documentHash ) {\n                //History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);\n\n                // Equalise\n                lastIframeHash = iframeHash = documentHash;\n\n                // Create History Entry\n                iframe.contentWindow.document.open();\n                iframe.contentWindow.document.close();\n\n                // Update the iframe's hash\n                iframe.contentWindow.document.location.hash = History.escapeHash(documentHash);\n              }\n\n              // Trigger Hashchange Event\n              History.Adapter.trigger(window,'hashchange');\n            }\n\n            // The iFrame Hash has changed (back button caused)\n            else if ( iframeHash !== lastIframeHash ) {\n              //History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);\n\n              // Equalise\n              lastIframeHash = iframeHash;\n\n              // If there is no iframe hash that means we're at the original\n              // iframe state.\n              // And if there was a hash on the original request, the original\n              // iframe state was replaced instantly, so skip this state and take\n              // the user back to where they came from.\n              if (startedWithHash && iframeHash === '') {\n                History.back();\n              }\n              else {\n                // Update the Hash\n                History.setHash(iframeHash,false);\n              }\n            }\n\n            // Reset Running\n            checkerRunning = false;\n\n            // Return true\n            return true;\n          };\n        }\n        else {\n          // We are not IE\n          // Firefox 1 or 2, Opera\n\n          // Define the checker function\n          History.checkerFunction = function(){\n            // Prepare\n            var documentHash = History.getHash()||'';\n\n            // The Document Hash has changed (application caused)\n            if ( documentHash !== lastDocumentHash ) {\n              // Equalise\n              lastDocumentHash = documentHash;\n\n              // Trigger Hashchange Event\n              History.Adapter.trigger(window,'hashchange');\n            }\n\n            // Return true\n            return true;\n          };\n        }\n\n        // Apply the checker function\n        History.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));\n\n        // Done\n        return true;\n      }; // History.hashChangeInit\n\n      // Bind hashChangeInit\n      History.Adapter.onDomLoad(History.hashChangeInit);\n\n    } // History.emulated.hashChange\n\n\n    // ====================================================================\n    // HTML5 State Support\n\n    // Non-Native pushState Implementation\n    if ( History.emulated.pushState ) {\n      /*\n       * We must emulate the HTML5 State Management by using HTML4 HashChange\n       */\n\n      /**\n       * History.onHashChange(event)\n       * Trigger HTML5's window.onpopstate via HTML4 HashChange Support\n       */\n      History.onHashChange = function(event){\n        //History.debug('History.onHashChange', arguments);\n\n        // Prepare\n        var currentUrl = ((event && event.newURL) || History.getLocationHref()),\n          currentHash = History.getHashByUrl(currentUrl),\n          currentState = null,\n          currentStateHash = null,\n          currentStateHashExits = null,\n          discardObject;\n\n        // Check if we are the same state\n        if ( History.isLastHash(currentHash) ) {\n          // There has been no change (just the page's hash has finally propagated)\n          //History.debug('History.onHashChange: no change');\n          History.busy(false);\n          return false;\n        }\n\n        // Reset the double check\n        History.doubleCheckComplete();\n\n        // Store our location for use in detecting back/forward direction\n        History.saveHash(currentHash);\n\n        // Expand Hash\n        if ( currentHash && History.isTraditionalAnchor(currentHash) ) {\n          //History.debug('History.onHashChange: traditional anchor', currentHash);\n          // Traditional Anchor Hash\n          History.Adapter.trigger(window,'anchorchange');\n          History.busy(false);\n          return false;\n        }\n\n        // Create State\n        currentState = History.extractState(History.getFullUrl(currentHash||History.getLocationHref()),true);\n\n        // Check if we are the same state\n        if ( History.isLastSavedState(currentState) ) {\n          //History.debug('History.onHashChange: no change');\n          // There has been no change (just the page's hash has finally propagated)\n          History.busy(false);\n          return false;\n        }\n\n        // Create the state Hash\n        currentStateHash = History.getHashByState(currentState);\n\n        // Check if we are DiscardedState\n        discardObject = History.discardedState(currentState);\n        if ( discardObject ) {\n          // Ignore this state as it has been discarded and go back to the state before it\n          if ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {\n            // We are going backwards\n            //History.debug('History.onHashChange: go backwards');\n            History.back(false);\n          } else {\n            // We are going forwards\n            //History.debug('History.onHashChange: go forwards');\n            History.forward(false);\n          }\n          return false;\n        }\n\n        // Push the new HTML5 State\n        //History.debug('History.onHashChange: success hashchange');\n        History.pushState(currentState.data,currentState.title,encodeURI(currentState.url),false);\n\n        // End onHashChange closure\n        return true;\n      };\n      History.Adapter.bind(window,'hashchange',History.onHashChange);\n\n      /**\n       * History.pushState(data,title,url)\n       * Add a new State to the history object, become it, and trigger onpopstate\n       * We have to trigger for HTML4 compatibility\n       * @param {object} data\n       * @param {string} title\n       * @param {string} url\n       * @return {true}\n       */\n      History.pushState = function(data,title,url,queue){\n        //History.debug('History.pushState: called', arguments);\n\n        // We assume that the URL passed in is URI-encoded, but this makes\n        // sure that it's fully URI encoded; any '%'s that are encoded are\n        // converted back into '%'s\n        url = encodeURI(url).replace(/%25/g, \"%\");\n\n        // Check the State\n        if ( History.getHashByUrl(url) ) {\n          throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n        }\n\n        // Handle Queueing\n        if ( queue !== false && History.busy() ) {\n          // Wait + Push to Queue\n          //History.debug('History.pushState: we must wait', arguments);\n          History.pushQueue({\n            scope: History,\n            callback: History.pushState,\n            args: arguments,\n            queue: queue\n          });\n          return false;\n        }\n\n        // Make Busy\n        History.busy(true);\n\n        // Fetch the State Object\n        var newState = History.createStateObject(data,title,url),\n          newStateHash = History.getHashByState(newState),\n          oldState = History.getState(false),\n          oldStateHash = History.getHashByState(oldState),\n          html4Hash = History.getHash(),\n          wasExpected = History.expectedStateId == newState.id;\n\n        // Store the newState\n        History.storeState(newState);\n        History.expectedStateId = newState.id;\n\n        // Recycle the State\n        History.recycleState(newState);\n\n        // Force update of the title\n        History.setTitle(newState);\n\n        // Check if we are the same State\n        if ( newStateHash === oldStateHash ) {\n          //History.debug('History.pushState: no change', newStateHash);\n          History.busy(false);\n          return false;\n        }\n\n        // Update HTML5 State\n        History.saveState(newState);\n\n        // Fire HTML5 Event\n        if(!wasExpected)\n          History.Adapter.trigger(window,'statechange');\n\n        // Update HTML4 Hash\n        if ( !History.isHashEqual(newStateHash, html4Hash) && !History.isHashEqual(newStateHash, History.getShortUrl(History.getLocationHref())) ) {\n          History.setHash(newStateHash,false);\n        }\n\n        History.busy(false);\n\n        // End pushState closure\n        return true;\n      };\n\n      /**\n       * History.replaceState(data,title,url)\n       * Replace the State and trigger onpopstate\n       * We have to trigger for HTML4 compatibility\n       * @param {object} data\n       * @param {string} title\n       * @param {string} url\n       * @return {true}\n       */\n      History.replaceState = function(data,title,url,queue){\n        //History.debug('History.replaceState: called', arguments);\n\n        // We assume that the URL passed in is URI-encoded, but this makes\n        // sure that it's fully URI encoded; any '%'s that are encoded are\n        // converted back into '%'s\n        url = encodeURI(url).replace(/%25/g, \"%\");\n\n        // Check the State\n        if ( History.getHashByUrl(url) ) {\n          throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n        }\n\n        // Handle Queueing\n        if ( queue !== false && History.busy() ) {\n          // Wait + Push to Queue\n          //History.debug('History.replaceState: we must wait', arguments);\n          History.pushQueue({\n            scope: History,\n            callback: History.replaceState,\n            args: arguments,\n            queue: queue\n          });\n          return false;\n        }\n\n        // Make Busy\n        History.busy(true);\n\n        // Fetch the State Objects\n        var newState        = History.createStateObject(data,title,url),\n          newStateHash = History.getHashByState(newState),\n          oldState        = History.getState(false),\n          oldStateHash = History.getHashByState(oldState),\n          previousState   = History.getStateByIndex(-2);\n\n        // Discard Old State\n        History.discardState(oldState,newState,previousState);\n\n        // If the url hasn't changed, just store and save the state\n        // and fire a statechange event to be consistent with the\n        // html 5 api\n        if ( newStateHash === oldStateHash ) {\n          // Store the newState\n          History.storeState(newState);\n          History.expectedStateId = newState.id;\n\n          // Recycle the State\n          History.recycleState(newState);\n\n          // Force update of the title\n          History.setTitle(newState);\n\n          // Update HTML5 State\n          History.saveState(newState);\n\n          // Fire HTML5 Event\n          //History.debug('History.pushState: trigger popstate');\n          History.Adapter.trigger(window,'statechange');\n          History.busy(false);\n        }\n        else {\n          // Alias to PushState\n          History.pushState(newState.data,newState.title,newState.url,false);\n        }\n\n        // End replaceState closure\n        return true;\n      };\n\n    } // History.emulated.pushState\n\n\n\n    // ====================================================================\n    // Initialise\n\n    // Non-Native pushState Implementation\n    if ( History.emulated.pushState ) {\n      /**\n       * Ensure initial state is handled correctly\n       */\n      if ( History.getHash() && !History.emulated.hashChange ) {\n        History.Adapter.onDomLoad(function(){\n          History.Adapter.trigger(window,'hashchange');\n        });\n      }\n\n    } // History.emulated.pushState\n\n  }; // History.initHtml4\n\n  // Try to Initialise History\n  if ( typeof History.init !== 'undefined' ) {\n    History.init();\n  }\n\n})(window);\n/**\n * History.js Core\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n  \"use strict\";\n\n  // ========================================================================\n  // Initialise\n\n  // Localise Globals\n  var\n    console = window.console||undefined, // Prevent a JSLint complain\n    document = window.document, // Make sure we are using the correct document\n    navigator = window.navigator, // Make sure we are using the correct navigator\n    sessionStorage = false, // sessionStorage\n    setTimeout = window.setTimeout,\n    clearTimeout = window.clearTimeout,\n    setInterval = window.setInterval,\n    clearInterval = window.clearInterval,\n    JSON = window.JSON,\n    alert = window.alert,\n    History = window.History = window.History||{}, // Public History Object\n    history = window.history; // Old History Object\n\n  try {\n    sessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)\n    sessionStorage.setItem('TEST', '1');\n    sessionStorage.removeItem('TEST');\n  } catch(e) {\n    sessionStorage = false;\n  }\n\n  // MooTools Compatibility\n  JSON.stringify = JSON.stringify||JSON.encode;\n  JSON.parse = JSON.parse||JSON.decode;\n\n  // Check Existence\n  if ( typeof History.init !== 'undefined' ) {\n    throw new Error('History.js Core has already been loaded...');\n  }\n\n  // Initialise History\n  History.init = function(options){\n    // Check Load Status of Adapter\n    if ( typeof History.Adapter === 'undefined' ) {\n      return false;\n    }\n\n    // Check Load Status of Core\n    if ( typeof History.initCore !== 'undefined' ) {\n      History.initCore();\n    }\n\n    // Check Load Status of HTML4 Support\n    if ( typeof History.initHtml4 !== 'undefined' ) {\n      History.initHtml4();\n    }\n\n    // Return true\n    return true;\n  };\n\n\n  // ========================================================================\n  // Initialise Core\n\n  // Initialise Core\n  History.initCore = function(options){\n    // Initialise\n    if ( typeof History.initCore.initialized !== 'undefined' ) {\n      // Already Loaded\n      return false;\n    }\n    else {\n      History.initCore.initialized = true;\n    }\n\n\n    // ====================================================================\n    // Options\n\n    /**\n     * History.options\n     * Configurable options\n     */\n    History.options = History.options||{};\n\n    /**\n     * History.options.hashChangeInterval\n     * How long should the interval be before hashchange checks\n     */\n    History.options.hashChangeInterval = History.options.hashChangeInterval || 100;\n\n    /**\n     * History.options.safariPollInterval\n     * How long should the interval be before safari poll checks\n     */\n    History.options.safariPollInterval = History.options.safariPollInterval || 500;\n\n    /**\n     * History.options.doubleCheckInterval\n     * How long should the interval be before we perform a double check\n     */\n    History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;\n\n    /**\n     * History.options.disableSuid\n     * Force History not to append suid\n     */\n    History.options.disableSuid = History.options.disableSuid || false;\n\n    /**\n     * History.options.storeInterval\n     * How long should we wait between store calls\n     */\n    History.options.storeInterval = History.options.storeInterval || 1000;\n\n    /**\n     * History.options.busyDelay\n     * How long should we wait between busy events\n     */\n    History.options.busyDelay = History.options.busyDelay || 250;\n\n    /**\n     * History.options.debug\n     * If true will enable debug messages to be logged\n     */\n    History.options.debug = History.options.debug || false;\n\n    /**\n     * History.options.initialTitle\n     * What is the title of the initial state\n     */\n    History.options.initialTitle = History.options.initialTitle || document.title;\n\n    /**\n     * History.options.html4Mode\n     * If true, will force HTMl4 mode (hashtags)\n     */\n    History.options.html4Mode = History.options.html4Mode || false;\n\n    /**\n     * History.options.delayInit\n     * Want to override default options and call init manually.\n     */\n    History.options.delayInit = History.options.delayInit || false;\n\n\n    // ====================================================================\n    // Interval record\n\n    /**\n     * History.intervalList\n     * List of intervals set, to be cleared when document is unloaded.\n     */\n    History.intervalList = [];\n\n    /**\n     * History.clearAllIntervals\n     * Clears all setInterval instances.\n     */\n    History.clearAllIntervals = function(){\n      var i, il = History.intervalList;\n      if (typeof il !== \"undefined\" && il !== null) {\n        for (i = 0; i < il.length; i++) {\n          clearInterval(il[i]);\n        }\n        History.intervalList = null;\n      }\n    };\n\n\n    // ====================================================================\n    // Debug\n\n    /**\n     * History.debug(message,...)\n     * Logs the passed arguments if debug enabled\n     */\n    History.debug = function(){\n      if ( (History.options.debug||false) ) {\n        History.log.apply(History,arguments);\n      }\n    };\n\n    /**\n     * History.log(message,...)\n     * Logs the passed arguments\n     */\n    History.log = function(){\n      // Prepare\n      var\n        consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),\n        textarea = document.getElementById('log'),\n        message,\n        i,n,\n        args,arg\n        ;\n\n      // Write to Console\n      if ( consoleExists ) {\n        args = Array.prototype.slice.call(arguments);\n        message = args.shift();\n        if ( typeof console.debug !== 'undefined' ) {\n          console.debug.apply(console,[message,args]);\n        }\n        else {\n          console.log.apply(console,[message,args]);\n        }\n      }\n      else {\n        message = (\"\\n\"+arguments[0]+\"\\n\");\n      }\n\n      // Write to log\n      for ( i=1,n=arguments.length; i<n; ++i ) {\n        arg = arguments[i];\n        if ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {\n          try {\n            arg = JSON.stringify(arg);\n          }\n          catch ( Exception ) {\n            // Recursive Object\n          }\n        }\n        message += \"\\n\"+arg+\"\\n\";\n      }\n\n      // Textarea\n      if ( textarea ) {\n        textarea.value += message+\"\\n-----\\n\";\n        textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;\n      }\n      // No Textarea, No Console\n      else if ( !consoleExists ) {\n        alert(message);\n      }\n\n      // Return true\n      return true;\n    };\n\n\n    // ====================================================================\n    // Emulated Status\n\n    /**\n     * History.getInternetExplorerMajorVersion()\n     * Get's the major version of Internet Explorer\n     * @return {integer}\n     * @license Public Domain\n     * @author Benjamin Arthur Lupton <contact@balupton.com>\n     * @author James Padolsey <https://gist.github.com/527683>\n     */\n    History.getInternetExplorerMajorVersion = function(){\n      var result = History.getInternetExplorerMajorVersion.cached =\n          (typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')\n        ? History.getInternetExplorerMajorVersion.cached\n        : (function(){\n            var v = 3,\n                div = document.createElement('div'),\n                all = div.getElementsByTagName('i');\n            while ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}\n            return (v > 4) ? v : false;\n          })()\n        ;\n      return result;\n    };\n\n    /**\n     * History.isInternetExplorer()\n     * Are we using Internet Explorer?\n     * @return {boolean}\n     * @license Public Domain\n     * @author Benjamin Arthur Lupton <contact@balupton.com>\n     */\n    History.isInternetExplorer = function(){\n      var result =\n        History.isInternetExplorer.cached =\n        (typeof History.isInternetExplorer.cached !== 'undefined')\n          ? History.isInternetExplorer.cached\n          : Boolean(History.getInternetExplorerMajorVersion())\n        ;\n      return result;\n    };\n\n    /**\n     * History.emulated\n     * Which features require emulating?\n     */\n\n    if (History.options.html4Mode) {\n      History.emulated = {\n        pushState : true,\n        hashChange: true\n      };\n    }\n\n    else {\n\n      History.emulated = {\n        pushState: !Boolean(\n          window.history && window.history.pushState && window.history.replaceState\n          && !(\n            (/ Mobile\\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */\n            || (/AppleWebKit\\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */\n          )\n        ),\n        hashChange: Boolean(\n          !(('onhashchange' in window) || ('onhashchange' in document))\n          ||\n          (History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)\n        )\n      };\n    }\n\n    /**\n     * History.enabled\n     * Is History enabled?\n     */\n    History.enabled = !History.emulated.pushState;\n\n    /**\n     * History.bugs\n     * Which bugs are present\n     */\n    History.bugs = {\n      /**\n       * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call\n       * https://bugs.webkit.org/show_bug.cgi?id=56249\n       */\n      setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n      /**\n       * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions\n       * https://bugs.webkit.org/show_bug.cgi?id=42940\n       */\n      safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n      /**\n       * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)\n       */\n      ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),\n\n      /**\n       * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event\n       */\n      hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)\n    };\n\n    /**\n     * History.isEmptyObject(obj)\n     * Checks to see if the Object is Empty\n     * @param {Object} obj\n     * @return {boolean}\n     */\n    History.isEmptyObject = function(obj) {\n      for ( var name in obj ) {\n        if ( obj.hasOwnProperty(name) ) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    /**\n     * History.cloneObject(obj)\n     * Clones a object and eliminate all references to the original contexts\n     * @param {Object} obj\n     * @return {Object}\n     */\n    History.cloneObject = function(obj) {\n      var hash,newObj;\n      if ( obj ) {\n        hash = JSON.stringify(obj);\n        newObj = JSON.parse(hash);\n      }\n      else {\n        newObj = {};\n      }\n      return newObj;\n    };\n\n\n    // ====================================================================\n    // URL Helpers\n\n    /**\n     * History.getRootUrl()\n     * Turns \"http://mysite.com/dir/page.html?asd\" into \"http://mysite.com\"\n     * @return {String} rootUrl\n     */\n    History.getRootUrl = function(){\n      // Create\n      var rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);\n      if ( document.location.port||false ) {\n        rootUrl += ':'+document.location.port;\n      }\n      rootUrl += '/';\n\n      // Return\n      return rootUrl;\n    };\n\n    /**\n     * History.getBaseHref()\n     * Fetches the `href` attribute of the `<base href=\"...\">` element if it exists\n     * @return {String} baseHref\n     */\n    History.getBaseHref = function(){\n      // Create\n      var\n        baseElements = document.getElementsByTagName('base'),\n        baseElement = null,\n        baseHref = '';\n\n      // Test for Base Element\n      if ( baseElements.length === 1 ) {\n        // Prepare for Base Element\n        baseElement = baseElements[0];\n        baseHref = baseElement.href.replace(/[^\\/]+$/,'');\n      }\n\n      // Adjust trailing slash\n      baseHref = baseHref.replace(/\\/+$/,'');\n      if ( baseHref ) baseHref += '/';\n\n      // Return\n      return baseHref;\n    };\n\n    /**\n     * History.getBaseUrl()\n     * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)\n     * @return {String} baseUrl\n     */\n    History.getBaseUrl = function(){\n      // Create\n      var baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();\n\n      // Return\n      return baseUrl;\n    };\n\n    /**\n     * History.getPageUrl()\n     * Fetches the URL of the current page\n     * @return {String} pageUrl\n     */\n    History.getPageUrl = function(){\n      // Fetch\n      var\n        State = History.getState(false,false),\n        stateUrl = (State||{}).url||History.getLocationHref(),\n        pageUrl;\n\n      // Create\n      pageUrl = stateUrl.replace(/\\/+$/,'').replace(/[^\\/]+$/,function(part,index,string){\n        return (/\\./).test(part) ? part : part+'/';\n      });\n\n      // Return\n      return pageUrl;\n    };\n\n    /**\n     * History.getBasePageUrl()\n     * Fetches the Url of the directory of the current page\n     * @return {String} basePageUrl\n     */\n    History.getBasePageUrl = function(){\n      // Create\n      var basePageUrl = (History.getLocationHref()).replace(/[#\\?].*/,'').replace(/[^\\/]+$/,function(part,index,string){\n        return (/[^\\/]$/).test(part) ? '' : part;\n      }).replace(/\\/+$/,'')+'/';\n\n      // Return\n      return basePageUrl;\n    };\n\n    /**\n     * History.getFullUrl(url)\n     * Ensures that we have an absolute URL and not a relative URL\n     * @param {string} url\n     * @param {Boolean} allowBaseHref\n     * @return {string} fullUrl\n     */\n    History.getFullUrl = function(url,allowBaseHref){\n      // Prepare\n      var fullUrl = url, firstChar = url.substring(0,1);\n      allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;\n\n      // Check\n      if ( /[a-z]+\\:\\/\\//.test(url) ) {\n        // Full URL\n      }\n      else if ( firstChar === '/' ) {\n        // Root URL\n        fullUrl = History.getRootUrl()+url.replace(/^\\/+/,'');\n      }\n      else if ( firstChar === '#' ) {\n        // Anchor URL\n        fullUrl = History.getPageUrl().replace(/#.*/,'')+url;\n      }\n      else if ( firstChar === '?' ) {\n        // Query URL\n        fullUrl = History.getPageUrl().replace(/[\\?#].*/,'')+url;\n      }\n      else {\n        // Relative URL\n        if ( allowBaseHref ) {\n          fullUrl = History.getBaseUrl()+url.replace(/^(\\.\\/)+/,'');\n        } else {\n          fullUrl = History.getBasePageUrl()+url.replace(/^(\\.\\/)+/,'');\n        }\n        // We have an if condition above as we do not want hashes\n        // which are relative to the baseHref in our URLs\n        // as if the baseHref changes, then all our bookmarks\n        // would now point to different locations\n        // whereas the basePageUrl will always stay the same\n      }\n\n      // Return\n      return fullUrl.replace(/\\#$/,'');\n    };\n\n    /**\n     * History.getShortUrl(url)\n     * Ensures that we have a relative URL and not a absolute URL\n     * @param {string} url\n     * @return {string} url\n     */\n    History.getShortUrl = function(url){\n      // Prepare\n      var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();\n\n      // Trim baseUrl\n      if ( History.emulated.pushState ) {\n        // We are in a if statement as when pushState is not emulated\n        // The actual url these short urls are relative to can change\n        // So within the same session, we the url may end up somewhere different\n        shortUrl = shortUrl.replace(baseUrl,'');\n      }\n\n      // Trim rootUrl\n      shortUrl = shortUrl.replace(rootUrl,'/');\n\n      // Ensure we can still detect it as a state\n      if ( History.isTraditionalAnchor(shortUrl) ) {\n        shortUrl = './'+shortUrl;\n      }\n\n      // Clean It\n      shortUrl = shortUrl.replace(/^(\\.\\/)+/g,'./').replace(/\\#$/,'');\n\n      // Return\n      return shortUrl;\n    };\n\n    /**\n     * History.getLocationHref(document)\n     * Returns a normalized version of document.location.href\n     * accounting for browser inconsistencies, etc.\n     *\n     * This URL will be URI-encoded and will include the hash\n     *\n     * @param {object} document\n     * @return {string} url\n     */\n    History.getLocationHref = function(doc) {\n      doc = doc || document;\n\n      // most of the time, this will be true\n      if (doc.URL === doc.location.href)\n        return doc.location.href;\n\n      // some versions of webkit URI-decode document.location.href\n      // but they leave document.URL in an encoded state\n      if (doc.location.href === decodeURIComponent(doc.URL))\n        return doc.URL;\n\n      // FF 3.6 only updates document.URL when a page is reloaded\n      // document.location.href is updated correctly\n      if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, \"\")) === doc.location.hash)\n        return doc.location.href;\n\n      if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)\n        return doc.location.href;\n\n      return doc.URL || doc.location.href;\n    };\n\n\n    // ====================================================================\n    // State Storage\n\n    /**\n     * History.store\n     * The store for all session specific data\n     */\n    History.store = {};\n\n    /**\n     * History.idToState\n     * 1-1: State ID to State Object\n     */\n    History.idToState = History.idToState||{};\n\n    /**\n     * History.stateToId\n     * 1-1: State String to State ID\n     */\n    History.stateToId = History.stateToId||{};\n\n    /**\n     * History.urlToId\n     * 1-1: State URL to State ID\n     */\n    History.urlToId = History.urlToId||{};\n\n    /**\n     * History.storedStates\n     * Store the states in an array\n     */\n    History.storedStates = History.storedStates||[];\n\n    /**\n     * History.savedStates\n     * Saved the states in an array\n     */\n    History.savedStates = History.savedStates||[];\n\n    /**\n     * History.noramlizeStore()\n     * Noramlize the store by adding necessary values\n     */\n    History.normalizeStore = function(){\n      History.store.idToState = History.store.idToState||{};\n      History.store.urlToId = History.store.urlToId||{};\n      History.store.stateToId = History.store.stateToId||{};\n    };\n\n    /**\n     * History.getState()\n     * Get an object containing the data, title and url of the current state\n     * @param {Boolean} friendly\n     * @param {Boolean} create\n     * @return {Object} State\n     */\n    History.getState = function(friendly,create){\n      // Prepare\n      if ( typeof friendly === 'undefined' ) { friendly = true; }\n      if ( typeof create === 'undefined' ) { create = true; }\n\n      // Fetch\n      var State = History.getLastSavedState();\n\n      // Create\n      if ( !State && create ) {\n        State = History.createStateObject();\n      }\n\n      // Adjust\n      if ( friendly ) {\n        State = History.cloneObject(State);\n        State.url = State.cleanUrl||State.url;\n      }\n\n      // Return\n      return State;\n    };\n\n    /**\n     * History.getIdByState(State)\n     * Gets a ID for a State\n     * @param {State} newState\n     * @return {String} id\n     */\n    History.getIdByState = function(newState){\n\n      // Fetch ID\n      var id = History.extractId(newState.url),\n        str;\n\n      if ( !id ) {\n        // Find ID via State String\n        str = History.getStateString(newState);\n        if ( typeof History.stateToId[str] !== 'undefined' ) {\n          id = History.stateToId[str];\n        }\n        else if ( typeof History.store.stateToId[str] !== 'undefined' ) {\n          id = History.store.stateToId[str];\n        }\n        else {\n          // Generate a new ID\n          while ( true ) {\n            id = (new Date()).getTime() + String(Math.random()).replace(/\\D/g,'');\n            if ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {\n              break;\n            }\n          }\n\n          // Apply the new State to the ID\n          History.stateToId[str] = id;\n          History.idToState[id] = newState;\n        }\n      }\n\n      // Return ID\n      return id;\n    };\n\n    /**\n     * History.normalizeState(State)\n     * Expands a State Object\n     * @param {object} State\n     * @return {object}\n     */\n    History.normalizeState = function(oldState){\n      // Variables\n      var newState, dataNotEmpty;\n\n      // Prepare\n      if ( !oldState || (typeof oldState !== 'object') ) {\n        oldState = {};\n      }\n\n      // Check\n      if ( typeof oldState.normalized !== 'undefined' ) {\n        return oldState;\n      }\n\n      // Adjust\n      if ( !oldState.data || (typeof oldState.data !== 'object') ) {\n        oldState.data = {};\n      }\n\n      // ----------------------------------------------------------------\n\n      // Create\n      newState = {};\n      newState.normalized = true;\n      newState.title = oldState.title||'';\n      newState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));\n      newState.hash = History.getShortUrl(newState.url);\n      newState.data = History.cloneObject(oldState.data);\n\n      // Fetch ID\n      newState.id = History.getIdByState(newState);\n\n      // ----------------------------------------------------------------\n\n      // Clean the URL\n      newState.cleanUrl = newState.url.replace(/\\??\\&_suid.*/,'');\n      newState.url = newState.cleanUrl;\n\n      // Check to see if we have more than just a url\n      dataNotEmpty = !History.isEmptyObject(newState.data);\n\n      // Apply\n      if ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {\n        // Add ID to Hash\n        newState.hash = History.getShortUrl(newState.url).replace(/\\??\\&_suid.*/,'');\n        if ( !/\\?/.test(newState.hash) ) {\n          newState.hash += '?';\n        }\n        newState.hash += '&_suid='+newState.id;\n      }\n\n      // Create the Hashed URL\n      newState.hashedUrl = History.getFullUrl(newState.hash);\n\n      // ----------------------------------------------------------------\n\n      // Update the URL if we have a duplicate\n      if ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {\n        newState.url = newState.hashedUrl;\n      }\n\n      // ----------------------------------------------------------------\n\n      // Return\n      return newState;\n    };\n\n    /**\n     * History.createStateObject(data,title,url)\n     * Creates a object based on the data, title and url state params\n     * @param {object} data\n     * @param {string} title\n     * @param {string} url\n     * @return {object}\n     */\n    History.createStateObject = function(data,title,url){\n      // Hashify\n      var State = {\n        'data': data,\n        'title': title,\n        'url': url\n      };\n\n      // Expand the State\n      State = History.normalizeState(State);\n\n      // Return object\n      return State;\n    };\n\n    /**\n     * History.getStateById(id)\n     * Get a state by it's UID\n     * @param {String} id\n     */\n    History.getStateById = function(id){\n      // Prepare\n      id = String(id);\n\n      // Retrieve\n      var State = History.idToState[id] || History.store.idToState[id] || undefined;\n\n      // Return State\n      return State;\n    };\n\n    /**\n     * Get a State's String\n     * @param {State} passedState\n     */\n    History.getStateString = function(passedState){\n      // Prepare\n      var State, cleanedState, str;\n\n      // Fetch\n      State = History.normalizeState(passedState);\n\n      // Clean\n      cleanedState = {\n        data: State.data,\n        title: passedState.title,\n        url: passedState.url\n      };\n\n      // Fetch\n      str = JSON.stringify(cleanedState);\n\n      // Return\n      return str;\n    };\n\n    /**\n     * Get a State's ID\n     * @param {State} passedState\n     * @return {String} id\n     */\n    History.getStateId = function(passedState){\n      // Prepare\n      var State, id;\n\n      // Fetch\n      State = History.normalizeState(passedState);\n\n      // Fetch\n      id = State.id;\n\n      // Return\n      return id;\n    };\n\n    /**\n     * History.getHashByState(State)\n     * Creates a Hash for the State Object\n     * @param {State} passedState\n     * @return {String} hash\n     */\n    History.getHashByState = function(passedState){\n      // Prepare\n      var State, hash;\n\n      // Fetch\n      State = History.normalizeState(passedState);\n\n      // Hash\n      hash = State.hash;\n\n      // Return\n      return hash;\n    };\n\n    /**\n     * History.extractId(url_or_hash)\n     * Get a State ID by it's URL or Hash\n     * @param {string} url_or_hash\n     * @return {string} id\n     */\n    History.extractId = function ( url_or_hash ) {\n      // Prepare\n      var id,parts,url, tmp;\n\n      // Extract\n\n      // If the URL has a #, use the id from before the #\n      if (url_or_hash.indexOf('#') != -1)\n      {\n        tmp = url_or_hash.split(\"#\")[0];\n      }\n      else\n      {\n        tmp = url_or_hash;\n      }\n\n      parts = /(.*)\\&_suid=([0-9]+)$/.exec(tmp);\n      url = parts ? (parts[1]||url_or_hash) : url_or_hash;\n      id = parts ? String(parts[2]||'') : '';\n\n      // Return\n      return id||false;\n    };\n\n    /**\n     * History.isTraditionalAnchor\n     * Checks to see if the url is a traditional anchor or not\n     * @param {String} url_or_hash\n     * @return {Boolean}\n     */\n    History.isTraditionalAnchor = function(url_or_hash){\n      // Check\n      var isTraditional = !(/[\\/\\?\\.]/.test(url_or_hash));\n\n      // Return\n      return isTraditional;\n    };\n\n    /**\n     * History.extractState\n     * Get a State by it's URL or Hash\n     * @param {String} url_or_hash\n     * @return {State|null}\n     */\n    History.extractState = function(url_or_hash,create){\n      // Prepare\n      var State = null, id, url;\n      create = create||false;\n\n      // Fetch SUID\n      id = History.extractId(url_or_hash);\n      if ( id ) {\n        State = History.getStateById(id);\n      }\n\n      // Fetch SUID returned no State\n      if ( !State ) {\n        // Fetch URL\n        url = History.getFullUrl(url_or_hash);\n\n        // Check URL\n        id = History.getIdByUrl(url)||false;\n        if ( id ) {\n          State = History.getStateById(id);\n        }\n\n        // Create State\n        if ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {\n          State = History.createStateObject(null,null,url);\n        }\n      }\n\n      // Return\n      return State;\n    };\n\n    /**\n     * History.getIdByUrl()\n     * Get a State ID by a State URL\n     */\n    History.getIdByUrl = function(url){\n      // Fetch\n      var id = History.urlToId[url] || History.store.urlToId[url] || undefined;\n\n      // Return\n      return id;\n    };\n\n    /**\n     * History.getLastSavedState()\n     * Get an object containing the data, title and url of the current state\n     * @return {Object} State\n     */\n    History.getLastSavedState = function(){\n      return History.savedStates[History.savedStates.length-1]||undefined;\n    };\n\n    /**\n     * History.getLastStoredState()\n     * Get an object containing the data, title and url of the current state\n     * @return {Object} State\n     */\n    History.getLastStoredState = function(){\n      return History.storedStates[History.storedStates.length-1]||undefined;\n    };\n\n    /**\n     * History.hasUrlDuplicate\n     * Checks if a Url will have a url conflict\n     * @param {Object} newState\n     * @return {Boolean} hasDuplicate\n     */\n    History.hasUrlDuplicate = function(newState) {\n      // Prepare\n      var hasDuplicate = false,\n        oldState;\n\n      // Fetch\n      oldState = History.extractState(newState.url);\n\n      // Check\n      hasDuplicate = oldState && oldState.id !== newState.id;\n\n      // Return\n      return hasDuplicate;\n    };\n\n    /**\n     * History.storeState\n     * Store a State\n     * @param {Object} newState\n     * @return {Object} newState\n     */\n    History.storeState = function(newState){\n      // Store the State\n      History.urlToId[newState.url] = newState.id;\n\n      // Push the State\n      History.storedStates.push(History.cloneObject(newState));\n\n      // Return newState\n      return newState;\n    };\n\n    /**\n     * History.isLastSavedState(newState)\n     * Tests to see if the state is the last state\n     * @param {Object} newState\n     * @return {boolean} isLast\n     */\n    History.isLastSavedState = function(newState){\n      // Prepare\n      var isLast = false,\n        newId, oldState, oldId;\n\n      // Check\n      if ( History.savedStates.length ) {\n        newId = newState.id;\n        oldState = History.getLastSavedState();\n        oldId = oldState.id;\n\n        // Check\n        isLast = (newId === oldId);\n      }\n\n      // Return\n      return isLast;\n    };\n\n    /**\n     * History.saveState\n     * Push a State\n     * @param {Object} newState\n     * @return {boolean} changed\n     */\n    History.saveState = function(newState){\n      // Check Hash\n      if ( History.isLastSavedState(newState) ) {\n        return false;\n      }\n\n      // Push the State\n      History.savedStates.push(History.cloneObject(newState));\n\n      // Return true\n      return true;\n    };\n\n    /**\n     * History.getStateByIndex()\n     * Gets a state by the index\n     * @param {integer} index\n     * @return {Object}\n     */\n    History.getStateByIndex = function(index){\n      // Prepare\n      var State = null;\n\n      // Handle\n      if ( typeof index === 'undefined' ) {\n        // Get the last inserted\n        State = History.savedStates[History.savedStates.length-1];\n      }\n      else if ( index < 0 ) {\n        // Get from the end\n        State = History.savedStates[History.savedStates.length+index];\n      }\n      else {\n        // Get from the beginning\n        State = History.savedStates[index];\n      }\n\n      // Return State\n      return State;\n    };\n\n    /**\n     * History.getCurrentIndex()\n     * Gets the current index\n     * @return (integer)\n    */\n    History.getCurrentIndex = function(){\n      // Prepare\n      var index = null;\n\n      // No states saved\n      if(History.savedStates.length < 1) {\n        index = 0;\n      }\n      else {\n        index = History.savedStates.length-1;\n      }\n      return index;\n    };\n\n    // ====================================================================\n    // Hash Helpers\n\n    /**\n     * History.getHash()\n     * @param {Location=} location\n     * Gets the current document hash\n     * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers\n     * @return {string}\n     */\n    History.getHash = function(doc){\n      var url = History.getLocationHref(doc),\n        hash;\n      hash = History.getHashByUrl(url);\n      return hash;\n    };\n\n    /**\n     * History.unescapeHash()\n     * normalize and Unescape a Hash\n     * @param {String} hash\n     * @return {string}\n     */\n    History.unescapeHash = function(hash){\n      // Prepare\n      var result = History.normalizeHash(hash);\n\n      // Unescape hash\n      result = decodeURIComponent(result);\n\n      // Return result\n      return result;\n    };\n\n    /**\n     * History.normalizeHash()\n     * normalize a hash across browsers\n     * @return {string}\n     */\n    History.normalizeHash = function(hash){\n      // Prepare\n      var result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');\n\n      // Return result\n      return result;\n    };\n\n    /**\n     * History.setHash(hash)\n     * Sets the document hash\n     * @param {string} hash\n     * @return {History}\n     */\n    History.setHash = function(hash,queue){\n      // Prepare\n      var State, pageUrl;\n\n      // Handle Queueing\n      if ( queue !== false && History.busy() ) {\n        // Wait + Push to Queue\n        //History.debug('History.setHash: we must wait', arguments);\n        History.pushQueue({\n          scope: History,\n          callback: History.setHash,\n          args: arguments,\n          queue: queue\n        });\n        return false;\n      }\n\n      // Log\n      //History.debug('History.setHash: called',hash);\n\n      // Make Busy + Continue\n      History.busy(true);\n\n      // Check if hash is a state\n      State = History.extractState(hash,true);\n      if ( State && !History.emulated.pushState ) {\n        // Hash is a state so skip the setHash\n        //History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);\n\n        // PushState\n        History.pushState(State.data,State.title,State.url,false);\n      }\n      else if ( History.getHash() !== hash ) {\n        // Hash is a proper hash, so apply it\n\n        // Handle browser bugs\n        if ( History.bugs.setHash ) {\n          // Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249\n\n          // Fetch the base page\n          pageUrl = History.getPageUrl();\n\n          // Safari hash apply\n          History.pushState(null,null,pageUrl+'#'+hash,false);\n        }\n        else {\n          // Normal hash apply\n          document.location.hash = hash;\n        }\n      }\n\n      // Chain\n      return History;\n    };\n\n    /**\n     * History.escape()\n     * normalize and Escape a Hash\n     * @return {string}\n     */\n    History.escapeHash = function(hash){\n      // Prepare\n      var result = History.normalizeHash(hash);\n\n      // Escape hash\n      result = window.encodeURIComponent(result);\n\n      // IE6 Escape Bug\n      if ( !History.bugs.hashEscape ) {\n        // Restore common parts\n        result = result\n          .replace(/\\%21/g,'!')\n          .replace(/\\%26/g,'&')\n          .replace(/\\%3D/g,'=')\n          .replace(/\\%3F/g,'?');\n      }\n\n      // Return result\n      return result;\n    };\n\n    /**\n     * History.getHashByUrl(url)\n     * Extracts the Hash from a URL\n     * @param {string} url\n     * @return {string} url\n     */\n    History.getHashByUrl = function(url){\n      // Extract the hash\n      var hash = String(url)\n        .replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')\n        ;\n\n      // Unescape hash\n      hash = History.unescapeHash(hash);\n\n      // Return hash\n      return hash;\n    };\n\n    /**\n     * History.setTitle(title)\n     * Applies the title to the document\n     * @param {State} newState\n     * @return {Boolean}\n     */\n    History.setTitle = function(newState){\n      // Prepare\n      var title = newState.title,\n        firstState;\n\n      // Initial\n      if ( !title ) {\n        firstState = History.getStateByIndex(0);\n        if ( firstState && firstState.url === newState.url ) {\n          title = firstState.title||History.options.initialTitle;\n        }\n      }\n\n      // Apply\n      try {\n        document.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');\n      }\n      catch ( Exception ) { }\n      document.title = title;\n\n      // Chain\n      return History;\n    };\n\n\n    // ====================================================================\n    // Queueing\n\n    /**\n     * History.queues\n     * The list of queues to use\n     * First In, First Out\n     */\n    History.queues = [];\n\n    /**\n     * History.busy(value)\n     * @param {boolean} value [optional]\n     * @return {boolean} busy\n     */\n    History.busy = function(value){\n      // Apply\n      if ( typeof value !== 'undefined' ) {\n        //History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);\n        History.busy.flag = value;\n      }\n      // Default\n      else if ( typeof History.busy.flag === 'undefined' ) {\n        History.busy.flag = false;\n      }\n\n      // Queue\n      if ( !History.busy.flag ) {\n        // Execute the next item in the queue\n        clearTimeout(History.busy.timeout);\n        var fireNext = function(){\n          var i, queue, item;\n          if ( History.busy.flag ) return;\n          for ( i=History.queues.length-1; i >= 0; --i ) {\n            queue = History.queues[i];\n            if ( queue.length === 0 ) continue;\n            item = queue.shift();\n            History.fireQueueItem(item);\n            History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n          }\n        };\n        History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n      }\n\n      // Return\n      return History.busy.flag;\n    };\n\n    /**\n     * History.busy.flag\n     */\n    History.busy.flag = false;\n\n    /**\n     * History.fireQueueItem(item)\n     * Fire a Queue Item\n     * @param {Object} item\n     * @return {Mixed} result\n     */\n    History.fireQueueItem = function(item){\n      return item.callback.apply(item.scope||History,item.args||[]);\n    };\n\n    /**\n     * History.pushQueue(callback,args)\n     * Add an item to the queue\n     * @param {Object} item [scope,callback,args,queue]\n     */\n    History.pushQueue = function(item){\n      // Prepare the queue\n      History.queues[item.queue||0] = History.queues[item.queue||0]||[];\n\n      // Add to the queue\n      History.queues[item.queue||0].push(item);\n\n      // Chain\n      return History;\n    };\n\n    /**\n     * History.queue (item,queue), (func,queue), (func), (item)\n     * Either firs the item now if not busy, or adds it to the queue\n     */\n    History.queue = function(item,queue){\n      // Prepare\n      if ( typeof item === 'function' ) {\n        item = {\n          callback: item\n        };\n      }\n      if ( typeof queue !== 'undefined' ) {\n        item.queue = queue;\n      }\n\n      // Handle\n      if ( History.busy() ) {\n        History.pushQueue(item);\n      } else {\n        History.fireQueueItem(item);\n      }\n\n      // Chain\n      return History;\n    };\n\n    /**\n     * History.clearQueue()\n     * Clears the Queue\n     */\n    History.clearQueue = function(){\n      History.busy.flag = false;\n      History.queues = [];\n      return History;\n    };\n\n\n    // ====================================================================\n    // IE Bug Fix\n\n    /**\n     * History.stateChanged\n     * States whether or not the state has changed since the last double check was initialised\n     */\n    History.stateChanged = false;\n\n    /**\n     * History.doubleChecker\n     * Contains the timeout used for the double checks\n     */\n    History.doubleChecker = false;\n\n    /**\n     * History.doubleCheckComplete()\n     * Complete a double check\n     * @return {History}\n     */\n    History.doubleCheckComplete = function(){\n      // Update\n      History.stateChanged = true;\n\n      // Clear\n      History.doubleCheckClear();\n\n      // Chain\n      return History;\n    };\n\n    /**\n     * History.doubleCheckClear()\n     * Clear a double check\n     * @return {History}\n     */\n    History.doubleCheckClear = function(){\n      // Clear\n      if ( History.doubleChecker ) {\n        clearTimeout(History.doubleChecker);\n        History.doubleChecker = false;\n      }\n\n      // Chain\n      return History;\n    };\n\n    /**\n     * History.doubleCheck()\n     * Create a double check\n     * @return {History}\n     */\n    History.doubleCheck = function(tryAgain){\n      // Reset\n      History.stateChanged = false;\n      History.doubleCheckClear();\n\n      // Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)\n      // Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940\n      if ( History.bugs.ieDoubleCheck ) {\n        // Apply Check\n        History.doubleChecker = setTimeout(\n          function(){\n            History.doubleCheckClear();\n            if ( !History.stateChanged ) {\n              //History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);\n              // Re-Attempt\n              tryAgain();\n            }\n            return true;\n          },\n          History.options.doubleCheckInterval\n        );\n      }\n\n      // Chain\n      return History;\n    };\n\n\n    // ====================================================================\n    // Safari Bug Fix\n\n    /**\n     * History.safariStatePoll()\n     * Poll the current state\n     * @return {History}\n     */\n    History.safariStatePoll = function(){\n      // Poll the URL\n\n      // Get the Last State which has the new URL\n      var\n        urlState = History.extractState(History.getLocationHref()),\n        newState;\n\n      // Check for a difference\n      if ( !History.isLastSavedState(urlState) ) {\n        newState = urlState;\n      }\n      else {\n        return;\n      }\n\n      // Check if we have a state with that url\n      // If not create it\n      if ( !newState ) {\n        //History.debug('History.safariStatePoll: new');\n        newState = History.createStateObject();\n      }\n\n      // Apply the New State\n      //History.debug('History.safariStatePoll: trigger');\n      History.Adapter.trigger(window,'popstate');\n\n      // Chain\n      return History;\n    };\n\n\n    // ====================================================================\n    // State Aliases\n\n    /**\n     * History.back(queue)\n     * Send the browser history back one item\n     * @param {Integer} queue [optional]\n     */\n    History.back = function(queue){\n      //History.debug('History.back: called', arguments);\n\n      // Handle Queueing\n      if ( queue !== false && History.busy() ) {\n        // Wait + Push to Queue\n        //History.debug('History.back: we must wait', arguments);\n        History.pushQueue({\n          scope: History,\n          callback: History.back,\n          args: arguments,\n          queue: queue\n        });\n        return false;\n      }\n\n      // Make Busy + Continue\n      History.busy(true);\n\n      // Fix certain browser bugs that prevent the state from changing\n      History.doubleCheck(function(){\n        History.back(false);\n      });\n\n      // Go back\n      history.go(-1);\n\n      // End back closure\n      return true;\n    };\n\n    /**\n     * History.forward(queue)\n     * Send the browser history forward one item\n     * @param {Integer} queue [optional]\n     */\n    History.forward = function(queue){\n      //History.debug('History.forward: called', arguments);\n\n      // Handle Queueing\n      if ( queue !== false && History.busy() ) {\n        // Wait + Push to Queue\n        //History.debug('History.forward: we must wait', arguments);\n        History.pushQueue({\n          scope: History,\n          callback: History.forward,\n          args: arguments,\n          queue: queue\n        });\n        return false;\n      }\n\n      // Make Busy + Continue\n      History.busy(true);\n\n      // Fix certain browser bugs that prevent the state from changing\n      History.doubleCheck(function(){\n        History.forward(false);\n      });\n\n      // Go forward\n      history.go(1);\n\n      // End forward closure\n      return true;\n    };\n\n    /**\n     * History.go(index,queue)\n     * Send the browser history back or forward index times\n     * @param {Integer} queue [optional]\n     */\n    History.go = function(index,queue){\n      //History.debug('History.go: called', arguments);\n\n      // Prepare\n      var i;\n\n      // Handle\n      if ( index > 0 ) {\n        // Forward\n        for ( i=1; i<=index; ++i ) {\n          History.forward(queue);\n        }\n      }\n      else if ( index < 0 ) {\n        // Backward\n        for ( i=-1; i>=index; --i ) {\n          History.back(queue);\n        }\n      }\n      else {\n        throw new Error('History.go: History.go requires a positive or negative integer passed.');\n      }\n\n      // Chain\n      return History;\n    };\n\n\n    // ====================================================================\n    // HTML5 State Support\n\n    // Non-Native pushState Implementation\n    if ( History.emulated.pushState ) {\n      /*\n       * Provide Skeleton for HTML4 Browsers\n       */\n\n      // Prepare\n      var emptyFunction = function(){};\n      History.pushState = History.pushState||emptyFunction;\n      History.replaceState = History.replaceState||emptyFunction;\n    } // History.emulated.pushState\n\n    // Native pushState Implementation\n    else {\n      /*\n       * Use native HTML5 History API Implementation\n       */\n\n      /**\n       * History.onPopState(event,extra)\n       * Refresh the Current State\n       */\n      History.onPopState = function(event,extra){\n        // Prepare\n        var stateId = false, newState = false, currentHash, currentState;\n\n        // Reset the double check\n        History.doubleCheckComplete();\n\n        // Check for a Hash, and handle apporiatly\n        currentHash = History.getHash();\n        if ( currentHash ) {\n          // Expand Hash\n          currentState = History.extractState(currentHash||History.getLocationHref(),true);\n          if ( currentState ) {\n            // We were able to parse it, it must be a State!\n            // Let's forward to replaceState\n            //History.debug('History.onPopState: state anchor', currentHash, currentState);\n            History.replaceState(currentState.data, currentState.title, currentState.url, false);\n          }\n          else {\n            // Traditional Anchor\n            //History.debug('History.onPopState: traditional anchor', currentHash);\n            History.Adapter.trigger(window,'anchorchange');\n            History.busy(false);\n          }\n\n          // We don't care for hashes\n          History.expectedStateId = false;\n          return false;\n        }\n\n        // Ensure\n        stateId = History.Adapter.extractEventData('state',event,extra) || false;\n\n        // Fetch State\n        if ( stateId ) {\n          // Vanilla: Back/forward button was used\n          newState = History.getStateById(stateId);\n        }\n        else if ( History.expectedStateId ) {\n          // Vanilla: A new state was pushed, and popstate was called manually\n          newState = History.getStateById(History.expectedStateId);\n        }\n        else {\n          // Initial State\n          newState = History.extractState(History.getLocationHref());\n        }\n\n        // The State did not exist in our store\n        if ( !newState ) {\n          // Regenerate the State\n          newState = History.createStateObject(null,null,History.getLocationHref());\n        }\n\n        // Clean\n        History.expectedStateId = false;\n\n        // Check if we are the same state\n        if ( History.isLastSavedState(newState) ) {\n          // There has been no change (just the page's hash has finally propagated)\n          //History.debug('History.onPopState: no change', newState, History.savedStates);\n          History.busy(false);\n          return false;\n        }\n\n        // Store the State\n        History.storeState(newState);\n        History.saveState(newState);\n\n        // Force update of the title\n        History.setTitle(newState);\n\n        // Fire Our Event\n        History.Adapter.trigger(window,'statechange');\n        History.busy(false);\n\n        // Return true\n        return true;\n      };\n      History.Adapter.bind(window,'popstate',History.onPopState);\n\n      /**\n       * History.pushState(data,title,url)\n       * Add a new State to the history object, become it, and trigger onpopstate\n       * We have to trigger for HTML4 compatibility\n       * @param {object} data\n       * @param {string} title\n       * @param {string} url\n       * @return {true}\n       */\n      History.pushState = function(data,title,url,queue){\n        //History.debug('History.pushState: called', arguments);\n\n        // Check the State\n        if ( History.getHashByUrl(url) && History.emulated.pushState ) {\n          throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n        }\n\n        // Handle Queueing\n        if ( queue !== false && History.busy() ) {\n          // Wait + Push to Queue\n          //History.debug('History.pushState: we must wait', arguments);\n          History.pushQueue({\n            scope: History,\n            callback: History.pushState,\n            args: arguments,\n            queue: queue\n          });\n          return false;\n        }\n\n        // Make Busy + Continue\n        History.busy(true);\n\n        // Create the newState\n        var newState = History.createStateObject(data,title,url);\n\n        // Check it\n        if ( History.isLastSavedState(newState) ) {\n          // Won't be a change\n          History.busy(false);\n        }\n        else {\n          // Store the newState\n          History.storeState(newState);\n          History.expectedStateId = newState.id;\n\n          // Push the newState\n          history.pushState(newState.id,newState.title,newState.url);\n\n          // Fire HTML5 Event\n          History.Adapter.trigger(window,'popstate');\n        }\n\n        // End pushState closure\n        return true;\n      };\n\n      /**\n       * History.replaceState(data,title,url)\n       * Replace the State and trigger onpopstate\n       * We have to trigger for HTML4 compatibility\n       * @param {object} data\n       * @param {string} title\n       * @param {string} url\n       * @return {true}\n       */\n      History.replaceState = function(data,title,url,queue){\n        //History.debug('History.replaceState: called', arguments);\n\n        // Check the State\n        if ( History.getHashByUrl(url) && History.emulated.pushState ) {\n          throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n        }\n\n        // Handle Queueing\n        if ( queue !== false && History.busy() ) {\n          // Wait + Push to Queue\n          //History.debug('History.replaceState: we must wait', arguments);\n          History.pushQueue({\n            scope: History,\n            callback: History.replaceState,\n            args: arguments,\n            queue: queue\n          });\n          return false;\n        }\n\n        // Make Busy + Continue\n        History.busy(true);\n\n        // Create the newState\n        var newState = History.createStateObject(data,title,url);\n\n        // Check it\n        if ( History.isLastSavedState(newState) ) {\n          // Won't be a change\n          History.busy(false);\n        }\n        else {\n          // Store the newState\n          History.storeState(newState);\n          History.expectedStateId = newState.id;\n\n          // Push the newState\n          history.replaceState(newState.id,newState.title,newState.url);\n\n          // Fire HTML5 Event\n          History.Adapter.trigger(window,'popstate');\n        }\n\n        // End replaceState closure\n        return true;\n      };\n\n    } // !History.emulated.pushState\n\n\n    // ====================================================================\n    // Initialise\n\n    /**\n     * Load the Store\n     */\n    if ( sessionStorage ) {\n      // Fetch\n      try {\n        History.store = JSON.parse(sessionStorage.getItem('History.store'))||{};\n      }\n      catch ( err ) {\n        History.store = {};\n      }\n\n      // Normalize\n      History.normalizeStore();\n    }\n    else {\n      // Default Load\n      History.store = {};\n      History.normalizeStore();\n    }\n\n    /**\n     * Clear Intervals on exit to prevent memory leaks\n     */\n    History.Adapter.bind(window,\"unload\",History.clearAllIntervals);\n\n    /**\n     * Create the initial State\n     */\n    History.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));\n\n    /**\n     * Bind for Saving Store\n     */\n    if ( sessionStorage ) {\n      // When the page is closed\n      History.onUnload = function(){\n        // Prepare\n        var currentStore, item, currentStoreString;\n\n        // Fetch\n        try {\n          currentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};\n        }\n        catch ( err ) {\n          currentStore = {};\n        }\n\n        // Ensure\n        currentStore.idToState = currentStore.idToState || {};\n        currentStore.urlToId = currentStore.urlToId || {};\n        currentStore.stateToId = currentStore.stateToId || {};\n\n        // Sync\n        for ( item in History.idToState ) {\n          if ( !History.idToState.hasOwnProperty(item) ) {\n            continue;\n          }\n          currentStore.idToState[item] = History.idToState[item];\n        }\n        for ( item in History.urlToId ) {\n          if ( !History.urlToId.hasOwnProperty(item) ) {\n            continue;\n          }\n          currentStore.urlToId[item] = History.urlToId[item];\n        }\n        for ( item in History.stateToId ) {\n          if ( !History.stateToId.hasOwnProperty(item) ) {\n            continue;\n          }\n          currentStore.stateToId[item] = History.stateToId[item];\n        }\n\n        // Update\n        History.store = currentStore;\n        History.normalizeStore();\n\n        // In Safari, going into Private Browsing mode causes the\n        // Session Storage object to still exist but if you try and use\n        // or set any property/function of it it throws the exception\n        // \"QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to\n        // add something to storage that exceeded the quota.\" infinitely\n        // every second.\n        currentStoreString = JSON.stringify(currentStore);\n        try {\n          // Store\n          sessionStorage.setItem('History.store', currentStoreString);\n        }\n        catch (e) {\n          if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {\n            if (sessionStorage.length) {\n              // Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply\n              // removing/resetting the storage can work.\n              sessionStorage.removeItem('History.store');\n              sessionStorage.setItem('History.store', currentStoreString);\n            } else {\n              // Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.\n            }\n          } else {\n            throw e;\n          }\n        }\n      };\n\n      // For Internet Explorer\n      History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));\n\n      // For Other Browsers\n      History.Adapter.bind(window,'beforeunload',History.onUnload);\n      History.Adapter.bind(window,'unload',History.onUnload);\n\n      // Both are enabled for consistency\n    }\n\n    // Non-Native pushState Implementation\n    if ( !History.emulated.pushState ) {\n      // Be aware, the following is only for native pushState implementations\n      // If you are wanting to include something for all browsers\n      // Then include it above this if block\n\n      /**\n       * Setup Safari Fix\n       */\n      if ( History.bugs.safariPoll ) {\n        History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));\n      }\n\n      /**\n       * Ensure Cross Browser Compatibility\n       */\n      if ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {\n        /**\n         * Fix Safari HashChange Issue\n         */\n\n        // Setup Alias\n        History.Adapter.bind(window,'hashchange',function(){\n          History.Adapter.trigger(window,'popstate');\n        });\n\n        // Initialise Alias\n        if ( History.getHash() ) {\n          History.Adapter.onDomLoad(function(){\n            History.Adapter.trigger(window,'hashchange');\n          });\n        }\n      }\n\n    } // !History.emulated.pushState\n\n\n  }; // History.initCore\n\n  // Try to Initialise History\n  if (!History.options || !History.options.delayInit) {\n    History.init();\n  }\n\n})(window);\n","/**\n * @fileOverview Time ago in words in js but without jquery.\n * @author NathanG\n * @version 0.1.0\n */\n\n\n\n\n    /**\n     * Units of time required by TimeAgo\n     * @private\n     * @type array\n     */\n    var UNITS = [\n      { name: 'second', time: 30000,\n        fn: function(ms) { return Math.abs(ms) / 1000; } },\n      { name: 'minute', time: 45000,\n        fn: function(ms) { return UNITS[0].fn(ms) / 60; } },\n      { name: 'hour', time: 600000,\n        fn: function(ms) { return UNITS[1].fn(ms) / 60; } },\n      { name: 'day', fn: function(ms) { return UNITS[2].fn(ms) / 24; } },\n      { name: 'week', fn: function(ms) { return UNITS[3].fn(ms) / 7; } },\n      { name: 'month', fn: function(ms) { return UNITS[4].fn(ms) / 4; } },\n      { name: 'year', fn: function(ms) { return UNITS[5].fn(ms) / 12; } }\n    ];\n\n    /**\n     * Represents a time ago instance\n     *\n     * @param {object} el - Dom node. Should be time element with data-time\n     * attribute set\n     * @class TimeAgo\n     */\n    var TimeAgo = function(el, time) {\n      this.el = el;\n      this.time = time;\n      this.date = this._parseTime();\n\n      this.update();\n\n      return this;\n    };\n\n    /** @memberof TimeAgo */\n    TimeAgo.prototype = {\n\n      /**\n       * diff current time and el time\n       * @private\n       * @returns {number}\n       */\n      _getDifference: function() {\n        return new Date() - this.date;\n      },\n\n      /**\n       * Get time to diff from this.el\n       * @private\n       * @returns {string}\n       */\n      _getTime: function() {\n        return this.time || this.el.getAttribute('data-time');\n      },\n\n      /**\n       * Parse el time to date instance. Handle string of date or UTC\n       * @private\n       * @returns Date instance\n       */\n      _parseTime: function() {\n        var time = this._getTime(),\n            t;\n\n        return new Date((!!(t = time * 1)) ? t : time);\n      },\n\n      /**\n       * Work out measure of time we are counting time in... how many of which\n       * unit. Set this.unit, aswell as this.measure\n       *\n       * @private\n       */\n      _calculateMeasure: function() {\n        var lastMeasure;\n        var lastUnit = UNITS[0];\n\n        var i = 0;\n        var unit;\n        var measure;\n\n        while(unit = UNITS[i]) {\n          measure = unit.fn(this.difference);\n\n          if(measure < 1) {\n            this.measure = lastMeasure;\n            this.unit = lastUnit;\n            return;\n          }\n\n          lastUnit = unit;\n          lastMeasure = measure;\n\n          i++;\n        }\n\n        // if we get to last unit\n        this.measure = lastMeasure;\n        this.unit = lastUnit;\n      },\n\n      /**\n       * Set timeout for next update of instance. This is declared in unit.time\n       * if unit.time is falsy, then no live updates happen for unit.\n       *\n       * @private\n       */\n      _setTimeout: function() {\n        var time = this.unit.time,\n            that = this;\n\n        if(!time) { return; }\n\n        this._timeout = setTimeout(function() {\n          that.update();\n        }, time);\n      },\n\n      /**\n       * Either a count of unit, or words\n       *\n       * @private\n       * @returns {string}\n       */\n      _measureString: function() {\n        var out,\n            measure = this.measure;\n\n        if(measure < 2) {\n          out = (this.unit.name === 'hour') ? 'an' : 'a';\n        }else{\n          out = String(Math.floor(measure));\n        }\n\n        return out;\n      },\n\n      /**\n       * Output when a long amount of time has passed. i.e. not seconds.\n       * @private\n       * @returns {string} time ago in words\n       */\n      _longOutput: function() {\n        var prefix = null;\n        var measure = this.measure;\n        var measureFloor = Math.floor(measure);\n        var unitString = this.unit.name;\n\n        if(measureFloor !== measure) {\n          prefix = 'about';\n        }\n\n        if(measure >= 2) {\n          unitString += 's';\n        }\n\n        var out = [this._measureString(), unitString, 'ago'];\n\n        if(prefix) {\n          out.unshift(prefix);\n        }\n\n        return out.join(' ');\n      },\n\n      /**\n       * Output for when less than a minute has passed.\n       * @private\n       * @retuens {string}\n       */\n      _shortOutput: function() {\n        return 'less than a minute ago';\n      },\n\n      /**\n       * Is time diff in seconds?\n       * @private\n       * @returns {boolean}\n       */\n      _isSeconds: function() {\n        return (this.unit !== UNITS[0]);\n      },\n\n      /**\n       * @private\n       * @returns {string}\n       */\n      _outputString: function() {\n        return (this._isSeconds()) ? this._longOutput() : this._shortOutput();\n      },\n\n      /**\n       * update diff and update dom\n       */\n      update: function() {\n        this.difference = this._getDifference();\n        this._calculateMeasure();\n\n        this.el.innerHTML = this._outputString();\n        this._setTimeout();\n      },\n\n      destroy: function() {\n        // remove timeouts\n        clearTimeout(this._timeout);\n      }\n    };\n\n    /**\n     * Kick off TimeAgo for 1 or more dom nodes\n     *\n     * @param {array} els - array of dom nodes, see TimeAgo\n     */\n    TimeAgo.init = function(els) {\n      var times = [];\n\n      if(!els instanceof Array) {\n        throw(new Error('TimeAgo.init requires els'));\n      }\n\n      for(var i = 0; i < els.length; i++) {\n        var el = els[i];\n\n        times.push(TimeAgo.new(el));\n      }\n\n      return times;\n    };\n\n    /**\n     * New Timeago instance\n     *\n     * @param {object} el - see TimeAgo\n     * @returs TimeAgo instance\n     */\n    TimeAgo.new = function(el) {\n      if(typeof el === 'undefined') {\n        throw(new Error('TimeAgo.new requires el'));\n      }\n\n      return new TimeAgo(el);\n    };\n\n    export default TimeAgo\n\n","export const dgid = (id) => {\n  return document.getElementById(id)\n}\n\nexport const $ = (selector, scope) => {\n  scope = scope || document;\n  return scope.querySelector(selector);\n}\n\n/** @returns Array of matching nodes */\nexport const $$ = (selector, scope) => {\n  scope = scope || document;\n  return Array.prototype.slice.call(scope.querySelectorAll(selector));\n}\n\n/**\n * @param fn - function to be throttled\n * @param threshhold - min time in ms between calls to fn\n * @param scope - scope in which fn is executed\n * @returns throttled version of function\n */\nexport const throttle = function(fn, threshhold, scope) {\n  threshhold = threshhold || 300;\n\n  let last;\n  let deferTimer;\n\n  return function() {\n    let context = scope || this;\n    let now = (new Date()).getTime();\n    let args = arguments;\n\n    if(last && now < last + threshhold) {\n      clearTimeout(deferTimer);\n\n      deferTimer = setTimeout(function () {\n        last = now;\n        fn.apply(context, args);\n      }, threshhold);\n\n    } else {\n      last = now;\n      fn.apply(context, args);\n    }\n  }\n}\n","import crossroads from 'crossroads'\n\nimport 'historyjs/scripts/uncompressed/history'\nimport 'historyjs/scripts/uncompressed/history.adapter.native'\n\nexport default {\n  init: (App) => {\n\n    let State\n\n    crossroads.parse(document.location.pathname + document.location.search)\n\n    crossroads.bypassed.add((route) => {\n      alert('Not found.')\n    })\n\n    History = window.History\n\n    if(History.enabled) {\n      State = History.getState()\n\n      // set initial state to first page that was loaded\n      History.pushState(\n        {urlPath: window.location.pathname},\n        '',\n        State.urlPath\n      )\n    } else{\n      return false\n    }\n\n    History.Adapter.bind(window, 'statechange', () => {\n      crossroads.parse(document.location.pathname + document.location.search)\n    })\n\n    document.body.addEventListener('click', (e) => {\n\n      let target = e.target\n\n      while(target.tagName !== 'BODY') {\n\n        if(target.tagName === 'A') {\n\n          let href = target.getAttribute('href')\n\n          if(href.match(/^\\//)) {\n\n            e.preventDefault()\n\n            History.pushState(\n              { urlPath: href },\n              '',\n              href\n            )\n\n            return false\n          }\n        }\n\n        target = target.parentNode\n      }\n    })\n\n  }\n\n}\n"]}